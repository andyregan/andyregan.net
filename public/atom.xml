<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[$whois andyregan]]></title>
  <link href="http://andyregan.net/atom.xml" rel="self"/>
  <link href="http://andyregan.net/"/>
  <updated>2013-01-09T17:43:16+00:00</updated>
  <id>http://andyregan.net/</id>
  <author>
    <name><![CDATA[Andrew Regan]]></name>
    
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[Extract a Tar Archive to Multiple Directories Matching A Pattern]]></title>
    <link href="http://andyregan.net/extract-a-tar-archive-to-multiple-directories-matching-a-pattern/"/>
    <updated>2011-06-01T00:00:00+01:00</updated>
    <id>http://andyregan.net/extract-a-tar-archive-to-multiple-directories-matching-a-pattern</id>
    <content type="html"><![CDATA[<p>Sometimes you may need to extract the same tar archive into many directories at once.</p>

<p>The below command extracts <strong>/path/to/archive.tgz</strong> into the directories from
<strong>/path/to/destination/00</strong> to <strong>/path/to/destination/29</strong> .</p>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="o">[</span>me@host ~<span class="o">]</span><span class="nv">$ </span>ls -d /path/to/destination/<span class="o">[</span>0-2<span class="o">][</span>0-9<span class="o">]</span>/ | xargs -I <span class="o">{}</span> tar -xvzf /path/to/archive.tgz -C <span class="o">{}</span>
</span></code></pre></td></tr></table></div></figure>



]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Requesting GPUs At Job Submission With Torque]]></title>
    <link href="http://andyregan.net/requesting-gpus-at-job-submission-with-torque/"/>
    <updated>2011-05-09T00:00:00+01:00</updated>
    <id>http://andyregan.net/requesting-gpus-at-job-submission-with-torque</id>
    <content type="html"><![CDATA[<p><img class="center" src="http://andyregan.net/blog/wp-content/uploads/2011/05/gpu_torque.jpg" title="A picture of a GPU card" alt="A picture of a GPU card"></p>

<p>According to the <a href="http://www.adaptivecomputing.com/resources/docs/torque/3.7schedulinggpus.php">Torque Documentation</a>, <strong>&#8220;in TORQUE 2.5.4 and later, users can request GPUs on a node at job submission&#8221;</strong>. This
post describes how to configure Torque for this functionality, allowing GPU resources to be scheduled among multiple users.</p>

<p>In a future post, I will also describe one approach that could be used to manage mutually exclusive CUDA access to NVIDIA GPUs on a
multi-GPU compute node.</p>

<p>The examples that follow involve a single workstation with 2 NVIDIA GPU devices.</p>

<h2>Informing Torque Where the GPUs Are</h2>

<p>In order for Torque to know which nodes have GPUs, you must update the <a href="http://www.adaptivecomputing.com/resources/docs/torque/1.5nodeconfig.php">nodes</a> file. In the following example, I have specified
that <strong>node1</strong> has 12 CPU cores and 2 GPU devices.</p>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>root@service-node:~# cat /var/spool/torque/server_priv/nodes
</span><span class='line'>node1 <span class="nv">np</span><span class="o">=</span>12 <span class="nv">gpus</span><span class="o">=</span>2
</span></code></pre></td></tr></table></div></figure>


<p>After saving the changes, you must restart <strong>pbs_server</strong> for the change to take affect.</p>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>root@service-node:~# /etc/init.d/pbs_server restart
</span></code></pre></td></tr></table></div></figure>


<p>Looking at the <strong>pbsnodes</strong> output, we can see that Torque is now aware that there should be 2 GPU devices on <strong>node1</strong>.</p>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>user@login-node:~# pbsnodes -a
</span><span class='line'>node1
</span><span class='line'>     <span class="nv">np</span> <span class="o">=</span> 12
</span><span class='line'>     <span class="nv">gpus</span> <span class="o">=</span> 2
</span></code></pre></td></tr></table></div></figure>


<h2>Requesting GPUs at job submission</h2>

<p>When submitting a job, a user can request GPU devices similar to how they request CPU cores. In the following example,
I&#8217;m requesting an <a href="http://www.clusterresources.com/torquedocs21/users/2.2files.shtml#interactive">interactive job</a> with 1 node , 1 processor per node and 2 GPUs per node.</p>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>user@login-node:~<span class="nv">$ </span>qsub -I -l <span class="nv">nodes</span><span class="o">=</span>1:ppn<span class="o">=</span>1:gpus<span class="o">=</span>2
</span><span class='line'>qsub: waiting <span class="k">for </span>job &lt;job id&gt; to start
</span><span class='line'>qsub: job &lt;job id&gt; ready
</span></code></pre></td></tr></table></div></figure>


<p>When the job starts, Torque populates a file whose path is specified by the environment variable <code>$PBS_GPUFILE</code>. Each
allocated GPU appears on a separate line within this file.</p>

<p>As you can see, the contents of <code>$PBS_GPUFILE</code> show that the job has been allocated GPU index 0 and 1 (the first and
second GPU) on node1 to execute on.</p>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>user@login-node:~<span class="nv">$ </span>env | grep PBS_GPUFILE
</span><span class='line'><span class="nv">PBS_GPUFILE</span><span class="o">=</span>/var/spool/torque/aux/JOB_IDgpu
</span></code></pre></td></tr></table></div></figure>




<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>user@login-node:~<span class="nv">$ </span>cat /var/spool/torque/aux/JOB_IDgpu
</span><span class='line'>node1-gpu0
</span><span class='line'>node1-gpu1
</span></code></pre></td></tr></table></div></figure>


<h2>Restricting the GPUs available to CUDA to Those Allocated</h2>

<p>As specified in Torque&#8217;s documentation, <strong>&#8220;it is left up to the job&#8217;s owner to make sure that the job executes properly on the GPU&#8221;</strong>.</p>

<p>In my next post, I will describe how you can take advantage of the $CUDA_VISIBLE_DEVICES environment variable (available since CUDA 3.1) to restrict the GPUs available to CUDA to those allocated by Torque.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Allowing Debian Packages To Execute Scripts When Upgrading]]></title>
    <link href="http://andyregan.net/allowing-debian-packages-to-execute-scripts-when-upgrading/"/>
    <updated>2011-02-07T00:00:00+00:00</updated>
    <id>http://andyregan.net/allowing-debian-packages-to-execute-scripts-when-upgrading</id>
    <content type="html"><![CDATA[<p>As <a href="http://www.ichec.ie/about_us/david_delaharpegolden">David</a> came across this morning, some <a href="http://www.debian.org/">Debian</a> packages try to execute scripts in <strong>/tmp</strong>
during upgrade. Often <strong>/tmp</strong> is mounted <strong>noexec</strong> for security and this can cause upgrades to
fail. Files in partitions mounted <strong>noexec</strong> cannot be executed.</p>

<p>To complete the upgrades you can temporarily mount <strong>/tmp</strong> with <strong>exec</strong>, upgrade your packages
and then remount as per the <strong>noexec</strong> flag in your <strong>/etc/fstab</strong>.</p>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>mount -o remount,exec /tmp
</span><span class='line'><span class="nv">$ </span>aptitude safe-upgrade
</span><span class='line'><span class="nv">$ </span>mount -o remount /tmp
</span></code></pre></td></tr></table></div></figure>


<p>You can also <a href="http://wiki.mediatemple.net/w/%28ve%29:Configure_apt">change the default tmp directory that apt uses</a>.</p>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span><span class="nb">echo</span> <span class="s2">&quot;APT::ExtractTemplates::TempDir \&quot;/var/local/tmp\&quot;;&quot;</span> &gt;&gt; /etc/apt/apt.conf.d/50extracttemplates
</span><span class='line'><span class="nv">$ </span>mkdir /var/local/tmp/
</span></code></pre></td></tr></table></div></figure>



]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Creating Dovecot IMAP Folders In Mail.App]]></title>
    <link href="http://andyregan.net/creating-dovecot-imap-folders-in-mail-app/"/>
    <updated>2011-02-06T00:00:00+00:00</updated>
    <id>http://andyregan.net/creating-dovecot-imap-folders-in-mail-app</id>
    <content type="html"><![CDATA[<p>If you want to organise your Dovecot IMAP mailboxes into folders, it may seem intuitive to
just drag the them into a new mailbox. However, you may get the error message <strong>Target
mailbox doesn&#8217;t allow inferior mailboxes</strong>.</p>

<p>The solution is to explicitly create a folder, by adding a <code>/</code> to the end of the name you
give a new mailbox. Folders can contain other folders and mailboxes, whereas mailboxes
can only contain mail.</p>

<p>For example, in Mail.app go to <strong>Mailbox</strong> -> <strong>New Mailbox</strong> . Select where you want to
create the new folder and enter a name with a <code>/</code> at the end. If you don&#8217;t include the
<code>/</code>, a new mailbox will be created.</p>

<p><a href="http://andyregan.net/images/posts/creating-dovecot-imap-folders-in-mail-app/Screen-shot-2011-02-06-at-17.07.53.png"><img class="center" src="http://andyregan.net/images/posts/creating-dovecot-imap-folders-in-mail-app/Screen-shot-2011-02-06-at-17.07.53.png" title="'Screenshot of Mail.app'" ></a></p>

<p>In the image below, you can see a folder called <strong>TEST</strong> that contains a sub-folder
called <strong>TEST2</strong> and a mailbox called <strong>test</strong>.</p>

<p><a href="http://andyregan.net/images/posts/creating-dovecot-imap-folders-in-mail-app/Screen-shot-2011-02-06-at-17.08.24.png"><img class="center" src="http://andyregan.net/images/posts/creating-dovecot-imap-folders-in-mail-app/Screen-shot-2011-02-06-at-17.08.24.png" title="'Screen shot of Mail.app'" ></a></p>

<p>While the above example uses Mail.app, you&#8217;ll also need to add a <code>/</code> to the end of
Dovecot IMAP folder names in other clients such as Mozilla Thunderbird.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Mac Mini Resolution Problems &#8211; EDIDs And HDMI Matrix Switchers]]></title>
    <link href="http://andyregan.net/mac-mini-resolution-problems-edids-and-hdmi-matrix-switchers/"/>
    <updated>2011-02-05T00:00:00+00:00</updated>
    <id>http://andyregan.net/mac-mini-resolution-problems-edids-and-hdmi-matrix-switchers</id>
    <content type="html"><![CDATA[<p><a href="http://ichec.ie">ICHEC</a>&#8217;s offices are located on opposite sides of the country. Thanks to video conferencing,
our Dublin and Galway-based staff are able to hold frequent virtual meetings to cut down on
travel. When staff (or visitors) need to share content, such as a presentation, they can connect
their laptop to the video conferencing unit (a <a href="http://www.polycom.com/products/telepresence_video/telepresence_solutions/room_telepresence/hdx7000.html">Polycom HDX 7000</a>). They can then select the
content to display to the local and remote members of the conference call.</p>

<p>To cater for different types of video output, we use a HDMI Matrix Switcher that can take input
from a VGA, a DVI, or a HMDI cable and output to either the TV directly, the video conference
unit or both.</p>

<p><a href="http://andyregan.net/images/posts/mac-mini-resolution-problems-edids-and-hdmi-matrix-switchers/matrix_switcher.jpg"><img class="center" src="http://andyregan.net/images/posts/mac-mini-resolution-problems-edids-and-hdmi-matrix-switchers/matrix_switcher.jpg" width="300" title="matrix switcher" alt="matrix switcher"></a></p>

<p>We recently purchased a <a href="http://www.apple.com/macmini/">Mac Mini</a> for use as a permanent conference room PC connected
through the Matrix Switcher. Unfortunately, we found that the highest resolution on TV was only
full 1080p when the Polycom was left powered off. If the Polycom was powered on, the maximum
resolution to the TV was much lower. Worse, the Polycom intermittently failed to receive a
signal from the Mac Mini.</p>

<p><a href="http://upload.wikimedia.org/wikipedia/commons/thumb/6/67/2010_Mac_Mini_Ports.jpg/800px-2010_Mac_Mini_Ports.jpg"><img class="center" src="http://upload.wikimedia.org/wikipedia/commons/thumb/6/67/2010_Mac_Mini_Ports.jpg/800px-2010_Mac_Mini_Ports.jpg" width="300" title="Mac Mini" alt="Mac Mini"></a></p>

<p>Googling around for information, it seemed that the Mac Mini was confusing the EDID information
from the TV and Polycom unit as the data was coming through the Matrix Switcher. An <a href="http://en.wikipedia.org/wiki/Extended_display_identification_data">EDID
(Extended display identification data)</a> is how a digital display, like a monitor or TV,
tells your computer about itself. Your computer, through it&#8217;s graphics card, determines supported
display settings based on the EDID data is has received from your monitor. We tried a few
different suggested solutions without success.</p>

<p>In a stroke of sheer luck and brilliance, <a href="http://www.ichec.ie/about_us/david_delaharpegolden.php">David</a> found a <a href="http://www.kanexlive.com/products/iAdapt51.html">Kanex USB powered mini-DVI to HDMI
adapter</a> in a box of spare cables. One of the features of the adapter is <strong>&#8220;an auto EDID feature
built-in that adapts to maximum resolution depending on users display&#8221;</strong>. He plugged it in between
the Mac Mini and the Matrix Switcher and, lo and behold, we had consistent 1080p resolution to
both the TV and the Polycom!</p>

<p><a href="http://www.kanexlive.com/products/iAdapt51.html"><img class="center" src="http://andyregan.net/images/posts/mac-mini-resolution-problems-edids-and-hdmi-matrix-switchers/adapter-300x133.jpg" width="300" title="Kanex Adapter" alt="Kanex Adapter"></a></p>

<p>Another thing to watch out for is signal distortion when using a long-ish HDMI cable from the Mac
Mini to the TV. The shorter the cable, the better.</p>

<p>You might notice that the image does not quite fit the TV at first. Try setting the TV to <strong>PC</strong>
or <strong>Dot by Dot</strong> mode. Finally, you may also need to adjust the TV&#8217;s sharpness settings. We
found that if the sharpness was set too high, the OS X fonts would look pixelated.</p>

<p>Hopefully, someone might find this info useful.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[How to Use SSH Tunneling to Access A Subversion Server Behind NAT]]></title>
    <link href="http://andyregan.net/how-to-use-ssh-tunneling-to-access-a-subversion-server-behind-nat/"/>
    <updated>2011-02-04T00:00:00+00:00</updated>
    <id>http://andyregan.net/how-to-use-ssh-tunneling-to-access-a-subversion-server-behind-nat</id>
    <content type="html"><![CDATA[<h2>Now why would I want to do that?</h2>

<p>Let&#8217;s say that you have a subversion repository hosted on a PC in your office. It cannot be
accessed directly from the outside world because it is behind NAT.</p>

<p>If you can&#8217;t connect to a VPN or forward ports, but you <strong>can</strong> SSH from the server hosting
your repository to the client that will access the repository, then your could try using a
reverse SSH tunnel.</p>

<h2>Example</h2>

<p>In the following example, I&#8217;m assuming that both the server hosting the subversion repository
and the client trying to access the repository are running either a Linux distro or OS X. I&#8217;m
also assuming that you are accessing the repository using svn+ssh and that openssh (or
similar) is installed on both the client and server. (That&#8217;s a lot of assumptions!)</p>

<p>For the sake of simplicity, I&#8217;ll call the subversion server <strong>host-a</strong> and the client <strong>host-b</strong>.</p>

<h3>On Host-A</h3>

<p>Since you can SSH from host-a to host-b, the first thing you&#8217;ll need to do is create a reverse
SHH tunnel. Run the following command in a terminal on host-a where <strong>username</strong> is a valid
username on host-b.</p>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>ssh -fN -R 3022:localhost:22 username@host-b
</span></code></pre></td></tr></table></div></figure>


<p>This will prompt you to enter your account password on host-b and will open a new reverse
tunnel in the background. You can confirm that the tunnel is active using the ps command.</p>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="o">[</span>host-a<span class="o">]</span><span class="nv">$ </span>ps aux | grep 3022:
</span></code></pre></td></tr></table></div></figure>


<h3>On Host-B</h3>

<p>Next, (from any host) log into your account on host-b . Using the following command, you
should see that host-b is listening for incoming connections on port 3022.</p>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="o">[</span>host-b<span class="o">]</span><span class="nv">$netstat</span> -aln | grep 3022
</span></code></pre></td></tr></table></div></figure>


<p>Now edit the file at <code>~/.subversion/config</code> so that the following line is under the <code>[tunnels]</code>
section:</p>

<figure class='code'><figcaption><span>~/.subversion/config </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="o">[</span>tunnels<span class="o">]</span>
</span><span class='line'><span class="nv">sshtunnel</span> <span class="o">=</span> ssh -p 3022
</span></code></pre></td></tr></table></div></figure>


<p>You can then check out your repository from host-a with the following command where <strong>username</strong> is
your username on host-a.
<strong>(Note that the tunnel you opened from the subversion server must be still open)</strong></p>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>svn co svn+sshtunnel://username@localhost/path/to/svn/repository /path/to/local/copy
</span></code></pre></td></tr></table></div></figure>


<p>Once you&#8217;ve initially checked out the repository, you can add files, commit and update as you
normally would (as long as the ssh tunnel is still open from host-a).</p>

<h3>Horrible Attempt At A Helpful Diagram</h3>

<p>Sorry folks!</p>

<p><img class="center" src="http://andyregan.net/images/posts/how-to-use-ssh-tunneling-to-access-a-subversion-server-behind-nat/tunnel_example.png" title="ssh tunnel example" alt="ssh tunnel example"></p>

<h3>What do I need to do if I&#8217;m using git and not subversion?</h3>

<p>Glad you asked. You&#8217;ll need to add the following to <code>~/.ssh/config</code> on host-b.</p>

<figure class='code'><figcaption><span>~/.ssh/config </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>Host host-a
</span><span class='line'>HostName localhost
</span><span class='line'>Port 3022
</span></code></pre></td></tr></table></div></figure>


<p>Then you can just use use <code>[host-b]$ssh username@host-a</code> instead of <code>[host-b]$ssh -p 3022 localhost</code> .</p>

<p>So to clone the repository om host-a:</p>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="o">[</span>host-b<span class="o">]</span>git clone git+ssh://host-a/path/to/repo /path/to/local/clone
</span></code></pre></td></tr></table></div></figure>


<h3>Resources</h3>

<p>The following links contain more reverse tunnel tricks.</p>

<ul>
<li>http://www.marksanborn.net/howto/bypass-firewall-and-nat-with-reverse-ssh-tunnel/</li>
<li>http://rhnotebook.wordpress.com/2010/02/13/reverse-ssh-port-forwarding-t-o-i-c-o-r-g/</li>
</ul>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Renaming Many Files At Once with Pattern Matching in Bash]]></title>
    <link href="http://andyregan.net/renaming-many-files-at-once-with-pattern-matching-in-bash/"/>
    <updated>2010-11-25T00:00:00+00:00</updated>
    <id>http://andyregan.net/renaming-many-files-at-once-with-pattern-matching-in-bash</id>
    <content type="html"><![CDATA[<p>Sometimes you may need to rename many files at once in a similar way, such as removing a
specific string from their name. Rather than manually rename the files, you can use a method
described at <a href="http://snipplr.com/view/3648/batch-file-rename-with-awk-and-sed/">snipplr.com</a>. One of the advantages of this method is that you can preview
the changes you will make simply by omitting the final pipe to <code>/bin/bash</code> .</p>

<p>Let&#8217;s say you have a bunch of files which contain patterns you would like to remove. In the
following example, you might need to remove the string <strong>PatternOne.</strong> and <strong>PatternTwo.</strong>
from each file&#8217;s name.</p>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>ls -1 /path/to/files/
</span><span class='line'>PatternOne.001.PatternTwo.avi
</span><span class='line'>PatternOne.002.PatternTwo.avi
</span><span class='line'>PatternOne.003.PatternTwo.avi
</span><span class='line'>PatternOne.004.PatternTwo.avi
</span></code></pre></td></tr></table></div></figure>


<p>The first step is to use <code>awk</code> to create a serious of <code>mv</code> statements.</p>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>ls *.avi | awk <span class="s1">&#39;{print(&quot;mv &quot;$1&quot; &quot;$1)}&#39;</span>
</span><span class='line'>mv PatternOne.001.PatternTwo.avi PatternOne.001.PatternTwo.avi
</span><span class='line'>mv PatternOne.002.PatternTwo.avi PatternOne.002.PatternTwo.avi
</span><span class='line'>mv PatternOne.003.PatternTwo.avi PatternOne.003.PatternTwo.avi
</span><span class='line'>mv PatternOne.004.PatternTwo.avi PatternOne.004.PatternTwo.avi
</span></code></pre></td></tr></table></div></figure>


<p>Next, we pipe the <code>mv</code> statements to a <code>sed</code> command which removes <strong>PatternOne.</strong> from
the <code>mv</code> statement&#8217;s destination file.</p>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>ls *.avi | awk <span class="s1">&#39;{print(&quot;mv &quot;$1&quot; &quot;$1)}&#39;</span> | sed <span class="s1">&#39;s/PatternOne.//2&#39;</span>
</span><span class='line'>mv PatternOne.001.PatternTwo.avi 001.PatternTwo.avi
</span><span class='line'>mv PatternOne.002.PatternTwo.avi 002.PatternTwo.avi
</span><span class='line'>mv PatternOne.003.PatternTwo.avi 003.PatternTwo.avi
</span><span class='line'>mv PatternOne.004.PatternTwo.avi 004.PatternTwo.avi
</span></code></pre></td></tr></table></div></figure>


<p>Add another <code>sed</code> statement to remove <strong>PatternTwo.</strong></p>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>ls *.avi | awk <span class="s1">&#39;{print(&quot;mv &quot;$1&quot; &quot;$1)}&#39;</span> | sed <span class="s1">&#39;s/PatternOne.//2&#39;</span>| sed <span class="s1">&#39;s/PatternTwo.//2&#39;</span>
</span><span class='line'>mv PatternOne.001.PatternTwo.avi 001.avi
</span><span class='line'>mv PatternOne.002.PatternTwo.avi 002.avi
</span><span class='line'>mv PatternOne.003.PatternTwo.avi 003.avi
</span><span class='line'>mv PatternOne.004.PatternTwo.avi 004.avi
</span></code></pre></td></tr></table></div></figure>


<p>Finally, pipe the result to <code>/bin/sh</code> so that the <code>mv</code> statements are run.</p>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>ls *.avi | awk <span class="s1">&#39;{print(&quot;mv &quot;$1&quot; &quot;$1)}&#39;</span> | sed <span class="s1">&#39;s/PatternOne.//2&#39;</span>| sed <span class="s1">&#39;s/PatternTwo.//2&#39;</span> | /bin/sh
</span></code></pre></td></tr></table></div></figure>



]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Firewalling Bridged VMs Using Libvirt&#8217;s Nwfilter Driver]]></title>
    <link href="http://andyregan.net/firewalling-bridged-vms-using-libvirts-nwfilter-driver/"/>
    <updated>2010-11-19T00:00:00+00:00</updated>
    <id>http://andyregan.net/firewalling-bridged-vms-using-libvirts-nwfilter-driver</id>
    <content type="html"><![CDATA[<p><a href="http://libvirt.org/"><img class="center" src="http://libvirt.org/libvirtLogo.png" width="200" title="libvirt logo" ></a></p>

<p>Recently, I needed to create a virtual machine to host an internet-facing web application. One of the
requirements for this VM included setting up a firewall on the VM&#8217;s host as well as on the guest itself
to provide an added layer of security.</p>

<p>Versions of <a href="http://libvirt.org/">libvirt</a> since 8.0 include the nwfilter driver. This driver allows you to define simple
network filtering rules in XML. Libvirt can then translate your rules to iptables/ebtables. More
information and examples are available at the <a href="http://libvirt.org/firewall.html">Libvirt Firewall Documentation</a> page.</p>

<p>It&#8217;s worth noting that while I found my nwfilter rules worked on Debian Squeeze (unstable), they did
not work on Debian Lenny. Even though I had upgraded libvirt to a more recent version from backports,
it&#8217;s likely that newer versions of dependent packages, such as iptables, are required also.</p>

<p>Another potential gotcha is described in the libvirt documentation:</p>

<blockquote><p>Finally, in terms of problems we have in deployment. The biggest problem is that if the admin does <br/>service iptables restart all our work gets blown away. Weâ€™ve experimented with using lokkit to <br/>record our custom rules in a persistent config file, but that caused different problem. Admins who <br/>were not using lokkit for their config found that all their own rules got blown away. So we threw <br/>away our lokkit code. Instead we document that if you run service iptables restart, you need to <br/>send SIGHUP to libvirt to make it recreate its rules.</p></blockquote>


<p>Unfortunately, there appears to be a <a href="http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=602428">bug</a> in the current version of libvirt-bin on Squeeze
(0.8.3-3) that causes the libvirt daemon to crash when you try to reload. This has been fixed
upstream. While waiting for next Debian Squeeze release of libvirt-bin, you can use the following
trick should iptables be restarted.</p>

<p>Simply, run <code>$virsh nwfilter-edit your-custom-template.xml</code> . Add a newline to the end of your XML
and save. Virsh will re-create your defined rules.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Lack of Entropy on Virtual Machine]]></title>
    <link href="http://andyregan.net/lack-of-entropy-on-virtual-machine/"/>
    <updated>2010-07-27T00:00:00+01:00</updated>
    <id>http://andyregan.net/lack-of-entropy-on-virtual-machine</id>
    <content type="html"><![CDATA[<p>If you are generating <a href="http://www.gnupg.org/">GPG keys</a> on a virtual machine, you may encounter the following error.</p>

<p><code>Not enough random bytes available. Please do some other work to give the OS a chance to collect more entropy!</code></p>

<p>Operating systems generate randomness based on hardware input. This randomness is collected for
use in applications which require random data (such as cryptographic applications). However, a virtual OS
does not have the same level of access to real hardware. As a result, the usual source of randomness
expected by the operating system is not available. The measure of randomness currently available (entropy)
can be viewed by running</p>

<figure class='code'><figcaption><span>entropy in linux </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>cat /proc/sys/kernel/random/entropy_avail
</span></code></pre></td></tr></table></div></figure>


<p>If the entropy pool drains, <strong>/dev/random</strong> will block until additional entropy is collected. One solution
is to use <strong>/dev/urandom</strong> as a source. This will not block, but will produce lower quality randomness.
You can use <strong>/dev/urandom</strong> by installing <a href="http://packages.debian.org/lenny/rng-tools">rng-tools</a> and adding the following to <strong>/etc/default/rng-tools</strong>.
Save and then restart rng-tools.</p>

<figure class='code'><figcaption><span>/etc/default/rng-tools </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">HRNGDEVICE</span><span class="o">=</span>/dev/urandom
</span></code></pre></td></tr></table></div></figure>


<p>Unfortunately, using <strong>/dev/urandom</strong> is not suitable for my security requirements. A better solution
would be to use a hardware entropy generator as described in <a href="http://strugglers.net/~andy/blog/2010/06/06/adventures-in-entropy-part-1/">Andy Smith&#8217;s excellent post</a> .</p>

<p>As a short-term work-around, I decided to generate keys on a physical host with a good quality source of
randomness and then <a href="http://www.debuntu.org/how-to-import-export-gpg-key-pair">import</a> them on the remote host.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Fix Mac OS X DNS Failure on UPC Router]]></title>
    <link href="http://andyregan.net/fix-mac-os-x-dns-failure-on-upc-router/"/>
    <updated>2010-07-17T00:00:00+01:00</updated>
    <id>http://andyregan.net/fix-mac-os-x-dns-failure-on-upc-router</id>
    <content type="html"><![CDATA[<p>About a week ago, I upgraded my MacBook Pro to OS X 10.6.4. Since then, I&#8217;ve had trouble with the internet
connection <strong>only</strong> from my house and <strong>only</strong> on my MBP. Sometimes the connection would work fine, but
most of the time Firefox/Safari would only load the first couple of pages and then new pages would start to
time out.</p>

<p>Since I could ping/view a site by going to the server&#8217;s IP address directly, the issue appeared to be with
the MBP resolving <a href="http://en.wikipedia.org/wiki/Domain_Name_System">DNS</a>. DNS is how your computer translates a human readable URL such as
<strong>andyregan.net</strong> to a machine readable IP address.</p>

<p>Since the problem was <strong>only</strong> with my UPC connection (router is Cisco EPC2425), I thought changing DNS
provider to <a href="http://code.google.com/speed/public-dns/">Google</a> or <a href="http://www.opendns.com/">OpenDNS</a> might do the trick. Alas, the new DNS servers would work for the
first few pages and then pages started timing out again.</p>

<p>After poking around the (extremely limited) options on the UPC router, I noticed that there were a ton of
firewall blocks for the 192.168.1.0/24 network over the last week. Devices connecting to the router, such
as my MBP, are assigned IP addresses within this range.</p>

<p>On closer inspection, I discovered that the router&#8217;s firewall was blocking the MBP from the DNS servers
for <strong>LAN-side UDP Flood</strong>. I turned off the router&#8217;s firewall and restarted it. Et voila! Bob&#8217;s your
uncle.</p>

<p>My guess is that the firewall blocks must be due to some change in DNS behavior since the last OS X
update. Posting here to save some poor soul the heartache. It&#8217;s important to note that turning off your
router&#8217;s firewall is at your own risk.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Quickly Reset Linux File and Directory Permissions]]></title>
    <link href="http://andyregan.net/quickly-reset-linux-file-and-directory-permissions/"/>
    <updated>2010-02-25T00:00:00+00:00</updated>
    <id>http://andyregan.net/quickly-reset-linux-file-and-directory-permissions</id>
    <content type="html"><![CDATA[<h2>Reset File Permissions</h2>

<p>Just a quick post so I can keep these commands handy (since I keep forgetting them). These will allow you to quickly set
different <a href="http://www.linuxquestions.org/linux/answers/Security/Quick_and_Dirty_Guide_to_Linux_File_Permissions">permissions</a> for all files (or all folders) within a specific directory in Linux.</p>

<figure class='code'><figcaption><span>reset files </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>find /path/to/directory/ -type f -exec chmod 644 <span class="o">{}</span> <span class="se">\;</span>
</span></code></pre></td></tr></table></div></figure>


<h2>Reset Directory Permissions</h2>

<figure class='code'><figcaption><span>reset directories </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>find /path/to/directory/ -type d -exec chmod 755 <span class="o">{}</span> <span class="se">\;</span>
</span></code></pre></td></tr></table></div></figure>


<h2>Reset Permissions on 777 PHP Files Only</h2>

<figure class='code'><figcaption><span>reset 777 php files </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>find /path/to/directory/ -name <span class="se">\*</span>.php -perm 777 -type f -exec chmod 644 <span class="o">{}</span> <span class="se">\;</span>
</span></code></pre></td></tr></table></div></figure>



]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Setting Up A New CakePHP Environment in Ubuntu]]></title>
    <link href="http://andyregan.net/setting-up-a-new-cakephp-environment-in-ubuntu/"/>
    <updated>2010-02-16T00:00:00+00:00</updated>
    <id>http://andyregan.net/setting-up-a-new-cakephp-environment-in-ubuntu</id>
    <content type="html"><![CDATA[<p><a href="http://cakephp.org"><img class="center" src="http://andyregan.net/images/posts/setting-up-a-new-cakephp-environment-in-ubuntu/cakephp_logo_250_trans-150x150.png" width="150" title="CakePHP Logo" alt="CakePHP Logo"></a></p>

<p><a href="http://cakephp.org">CakePHP</a> is a useful <a href="http://hubpages.com/hub/MVC">MVC</a> framework for PHP applications. However, there are a few common gotchas when setting up a new development
environment. In this post, I will go through how to get around these issues when setting up a new environment on a <a href="http://en.wikipedia.org/wiki/LAMP_%28software_bundle%29">LAMP</a> (Linux Apache
MySQL PHP) server, in this case server running an <a href="http://www.ubuntu.com">Ubuntu</a> OS. Please leave a comment if you have any feedback or
can recommend any improvements on the suggestions here.</p>

<h2>Grab a Copy and Get Started</h2>

<p>The first thing you&#8217;ll need to do is <a href="http://compsoc.nuigalway.ie/wiki/how_to:apache">get a local LAMP server up and running</a>. Then, grab
a fresh copy of CakePHP from <a href="http://cakephp.org">cakephp.org</a>. This site also has some useful resources if you&#8217;d like to learn more about the framework.</p>

<figure class='code'><figcaption><span>Grab the source </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>wget http://download.github.com/cakephp-cakephp1x-ef18ab2.tar.gz
</span></code></pre></td></tr></table></div></figure>


<p>Once you have downloaded the tarball, extract it and then rename the new directory to something more useful. This is the root directory of
the application.</p>

<figure class='code'><figcaption><span>Extract the source </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>tar -xvvzf cakephp-cakephp1x-ef18ab2.tar.gz
</span><span class='line'><span class="nv">$ </span>mv cakephp-cakephp1x-ef18ab2/ cake_project/
</span></code></pre></td></tr></table></div></figure>


<h2>Make Tmp/ Writable</h2>

<p>Next, you need to make sure that the <strong>tmp/</strong> directory is writeable. To avoid using insecure 777 permissions, I recommend installing <a href="http://www.suphp.org/Home.html">suPHP</a>.
SuPHP allows PHP scripts to be run as their owner rather than as the default Apache user (<strong>www-data</strong>). As a result, you can use more secure
file and directory permissions while still allowing the <strong>tmp/</strong> directory to be writeable by the application. Generally, 755 permissions
are sufficiently secure for directories and 644 for files.</p>

<p>Install the correct packages, enable <strong>suphp</strong> and disable the <strong>php5</strong> module.</p>

<figure class='code'><figcaption><span>Prepare the Environment </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>sudo apt-get install libapache2-mod-suphp suphp-common
</span><span class='line'><span class="nv">$ </span>sudo a2enmod suphp;sudo a2dismod php5;sudo /etc/init.d/apache2 restart
</span></code></pre></td></tr></table></div></figure>


<h2>Add A Dash of Salt</h2>

<p>With that out of the way, now you need to change the default salt value for the application. CakePHP needs a random string (&#8220;salt&#8221;) which is
used to generate secure hashes. I find the <a href="http://linux.die.net/man/1/pwgen">pwgen</a> utility in Linux very useful for quickly generating a random string.</p>

<p>Open up <strong>app/config/core.php</strong>. Then, replace the <strong>random_string</strong> value below with the output of the <strong>pwgen</strong> command .</p>

<figure class='code'><figcaption><span>app/config/core.php </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="x">Configure::write(&#39;Security.salt&#39;, &#39;random_string&#39;);</span>
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><figcaption><span>Prepare the Environment </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>pwgen -y 100
</span></code></pre></td></tr></table></div></figure>


<h2>Point Your Domain at the Cake Directory</h2>

<p>You can use Apache&#8217;s <a href="http://httpd.apache.org/docs/2.1/mod/mod_userdir.html">userdir</a> module to test your application. This will allow you to go to <strong>http://yourdomain.com/~username&#8221;</strong> in your
browser where <strong>/home/username/public_html</strong> is the document root. However, this often conflicts with the Apache <a href="http://httpd.apache.org/docs/1.3/mod/mod_rewrite.html">rewrite</a> module which
is necessary for &#8220;friendly&#8221; URLs.</p>

<p>To get around this conflict on a local development environment, I recommend pointing your domain at the application&#8217;s root directory. In
this way, when you go to the domain in your browser it will show you the newly installed CakePHP application.</p>

<p>First, add a rule to your computer&#8217;s <strong>/etc/hosts</strong> file so that the domain points to <a href="http://en.wikipedia.org/wiki/Localhost">localhost</a>.</p>

<figure class='code'><figcaption><span>/etc/hosts </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>127.0.0.1       caketest.com www.caketest.com
</span></code></pre></td></tr></table></div></figure>


<p>Then, add and enable a <a href="http://httpd.apache.org/docs/1.3/vhosts/">vhost</a> for the domain you are working on.</p>

<figure class='code'><figcaption><span>Edit the vhost </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>sudo vim /etc/apache2/sites-available/caketest.com
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><figcaption><span>/etc/apache2/sites-available/caketest.com </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>&lt;VirtualHost *:80 &gt;
</span><span class='line'><span class="c">#Basic setup  </span>
</span><span class='line'>ServerAdmin webmaster@mydomain.com
</span><span class='line'>ServerName caketest.com
</span><span class='line'>ServerAlias www.caketest.com
</span><span class='line'>DocumentRoot /home/andrew/public_html/cake
</span><span class='line'>
</span><span class='line'>ErrorLog /home/andrew/public_html/cake/error_log/error.log
</span><span class='line'>
</span><span class='line'>&lt;Directory /home/andrew/public_html/cake&gt;
</span><span class='line'>Order Deny,Allow
</span><span class='line'>Allow from all
</span><span class='line'><span class="c"># Don&#39;t show indexes for directories  </span>
</span><span class='line'>Options -Indexes
</span><span class='line'>&lt;/Directory&gt;
</span><span class='line'>&lt;/VirtualHost&gt;
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><figcaption><span>restart apache </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>sudo a2ensite caketest.com;/etc/init.d/apache2 restart
</span></code></pre></td></tr></table></div></figure>


<h2>Why is Everything Black and White?</h2>

<p>If the new Cake installation displays without any CSS markup, make sure that the Apache rewrite module is enabled. After that, your done.</p>

<figure class='code'><figcaption><span>Enable the rewrite module </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>sudo a2enmod rewrite;/etc/init.d/apache2 restart
</span></code></pre></td></tr></table></div></figure>


<p>At this point, you might want to check out the <a href="http://book.cakephp.org/">CakePHP documentation</a> which will give you more information on what to do from here.
You should also check out this article on <a href="http://www.tiplite.com/cakephp-support-in-netbeans/">using Netbeans as your developemnt IDE for CakePHP projects</a>.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Nasty Site Hack Leads to Phony Google Links]]></title>
    <link href="http://andyregan.net/nasty-site-hack-leads-to-phony-google-links/"/>
    <updated>2009-07-29T00:00:00+01:00</updated>
    <id>http://andyregan.net/nasty-site-hack-leads-to-phony-google-links</id>
    <content type="html"><![CDATA[<h2>Thar be nasty scripts here!</h2>

<p><img class="center" src="http://andyregan.net/blog/wp-content/uploads/2009/07/tornado_warning.gif" width="300" title="Warning Sign" alt="Thar be nasty scripts here!"></p>

<p>Came across a dirty (but interesting) website hack today. Essentially when a person googled their domain name they discovered hundreds
and hundreds of phony links pointing to a sub-directory of their site. (With various explicitly charming descriptions).
Clicking on these links displayed a page full of advertisements.</p>

<p>Had a nose around the sub-directory in question and couldn&#8217;t find any files corresponding to the links.</p>

<p>Eventually, I found a rogue PHP script (called <strong>report.php</strong>). Turns out that the <a href="http://httpd.apache.org/docs/1.3/howto/htaccess.html">.htaccess</a> file in the directory had been modified
to redirect any <strong><a href="http://en.wikipedia.org/wiki/HTTP_404">404 Not Found</a></strong> errors to the PHP script. Even dirtier still was that when you accessed the script directly in a
browser it showed a typical default 404 error, a tactic I guess is there to add confusion when you are trying to find the cause of the
hack. <strong>Bastards</strong>.</p>

<p>Script was <a href="http://www.wewatchyourwebsite.com/wordpress/?p=136">base64</a>&#8216;d and full of typical randomness meant to slow down those trying to figure out exactly what it&#8217;s trying to do.
As far as I can tell, it just serves up ad pages when it&#8217;s redirected to and the 404 error page when accessed directly.</p>

<p>The ultimate bastardly thing about this hack is that even after you clean up your site, it&#8217;ll be ages before the explicit phony links
dissappear from Google. Another good reason to avoid 777 permissions of directories and keep your web software updated.</p>

<p>Just wanted to make people aware of it. If you come across something similar have a look in the <strong>.htaccess</strong> file first. :)</p>

<h2>UPDATE</h2>

<p>The following bash one-liner can help find any files that contain a call to the base64_encode() method. Some legitimate files may be
included, but this should help narrow down the list of dirty scripts.</p>

<figure class='code'><figcaption><span>snippet </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$find</span> . -type f | xargs grep -l base64_encode
</span></code></pre></td></tr></table></div></figure>


<p>Also worth checking out the following links for htaccess tips and tricks:</p>

<ul>
<li><a href="http://www.askapache.com/htaccess/apache-htaccess.html">http://www.askapache.com/htaccess/apache-htaccess.html</a></li>
<li><a href="http://perishablepress.com/press/2006/01/10/stupid-htaccess-tricks/#sec1">http://perishablepress.com/press/2006/01/10/stupid-htaccess-tricks/#sec1</a></li>
</ul>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Shoot First Questions Later]]></title>
    <link href="http://andyregan.net/shoot-first-questions-later/"/>
    <updated>2009-04-29T00:00:00+01:00</updated>
    <id>http://andyregan.net/shoot-first-questions-later</id>
    <content type="html"><![CDATA[<p><a href="http://www.digitalmediaforum.net/event_profile.php?id=292"><img class="center" src="http://andyregan.net/images/posts/shoot-first-questions-later/sfql_graphic.png"" title="SFQL Graphic" alt="SFQL Graphic"> </a></p>

<p><a href="http://www.digitalmediaforum.net/event_profile.php?id=292">SFQL</a> is a different approach to business networking. Break the ice by playing a few LAN games and having a laugh. Afterwards, head to a nearby pub for some refreshments and have a chance to chat with like-minded people in the tech industry from Galway.</p>

<p>It&#8217;s happening May 6th from 7pm in Squareyes, Forster St (near Eyre Square). The cost of gaming is &euro;6.</p>

<p>This is a <a href="http://www.digitalmediaforum.net/about.php">Digital Media Forum</a> event. The idea was born at the last Digital Media Breakfast in Galway and has been put together thanks to <a href="http://twitter.com/antonmannering/">@antonmannering</a> and <a href="http://www.squareyes.com/">Squareyes</a>.</p>

<p>Promises to be good craic! Join via <a href="http://www.digitalmediaforum.net/event_profile.php?id=292">the event page</a> so we&#8217;ll have some idea of numbers. Thanks! :)</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[New Theme]]></title>
    <link href="http://andyregan.net/new-theme/"/>
    <updated>2009-04-29T00:00:00+01:00</updated>
    <id>http://andyregan.net/new-theme</id>
    <content type="html"><![CDATA[<p>I got a bit sick of the old fusion theme. The new theme is based on the <a href="http://themes.jestro.com/vigilance/">Vigilance Theme</a> by <a href="http://www.jestro.com/">Jestro</a> with some tweaks suggested in an excellent <a href="http://healyourchurchwebsite.com/2008/12/01/working-with-the-wordpress-theme-vigilance-116/">article by Dean Peters</a> along with a couple of tweaks of my own.</p>

<p>Header image is a photo I took atop the <a href="http://maps.google.com/maps?f=q&amp;source=s_q&amp;hl=en&amp;geocode=&amp;q=silver+strand+galway&amp;sll=53.273797,-9.05178&amp;sspn=0.091155,0.30899&amp;ie=UTF8&amp;ll=53.251299,-9.124403&amp;spn=0.0114,0.038624&amp;t=h&amp;z=15&amp;iwloc=I">cliff at Silver Strand overlooking Galway Bay</a>.</p>

<p>It&#8217;s a lot cleaner and I think it&#8217;s easier to read, too. Hope you like it!</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[I Can Haz Job?]]></title>
    <link href="http://andyregan.net/i-can-haz-job/"/>
    <updated>2009-04-26T00:00:00+01:00</updated>
    <id>http://andyregan.net/i-can-haz-job</id>
    <content type="html"><![CDATA[<div class="video-container">
<iframe width="640" height="360" src="http://www.youtube.com/embed/qTjAu03V9pY?feature=player_embedded" frameborder="0" allowfullscreen></iframe>
</div>


<p>According to RTE there should be plenty of work for me and my classmates when we graduate. Good to hear. (As Forrest Gump would say, &#8220;One less thing, you know?&#8221;.) Unfortunately, from my experience so far this year I don&#8217;t think it&#8217;s going to be quite as easy to get a good job in ICT as RTE suggests.</p>

<p>The dramatic reduction in the number of people studying computer sciences courses since the dot-com bust has been no more obvious than in my own course. At the start of this decade, GY350 Information Technology was very much in demand, with hundreds of students and Round 1 CAO points regularly over 400.</p>

<p>Today, there&#8217;s <strong>nine</strong> of us in final year.</p>

<p>What caused the continuous slump in applicants? According to a <a href="http://www.forfas.ie/publications/2008/title,951,en.php">report</a> published last year by Forf&aacute;s, the national policy advisory body for enterprise and science, the mammies and guidance councilors of Ireland share a large part of the blame.</p>

<p>When the numbers of ICT jobs started to fall sharply and graduates found themselves competing to find work the mammies of Ireland took heed. The word was out that the &#8221;<em>computhers</em> game&#8221; was a lame duck.</p>

<p>Nay not so. While fewer positions were available, the revenue generated by the ICT industry continued to grow and after 2004 the number of people employed in ICT began to steadily grow again. However, the stigma of the bust was not forgotten.</p>

<p>Personally, I know a number of people who wanted to study IT but were told &#8220;sure there&#8217;s no jobs in that&#8221; and &#8220;wouldn&#8217;t you study civil engineering and make a fortune like young Gombeen down the road?&#8221;.</p>

<p>Now we&#8217;re told Ireland doesn&#8217;t have enough IT graduates to meet demand. RTE reports that &#8220;50% of software hires in Dublin are from abroad&#8221; at a time when 4000 people (including many college graduates) are applying for 280 jobs in Ikea.</p>

<p>Aside from worries about job security, I also think that people have a poor understanding of the type of work that an IT student will do once they graduate. When I&#8217;m asked what I&#8217;m studying in college, I generally have to brace myself for the inevitable &#8220;Oh, you&#8217;re doing IT? Is there much work fixing computers?&#8221;. (Usually followed by a request to fix a broken printer or laptop. o_0 )</p>

<p>One of the main recommendations of the Forf&aacute;s report is &#8220;better communication of career opportunities and skills needs of the ICT sector &#8220;. I think a good effort is now being made by the government and 3rd level institutions to change people&#8217;s perceptions of ICT. Hopefully, this will lead to more applications over the coming years.</p>

<p>An unexpected side affect of the drop in demand for ICT courses was an increase in the drop out rate. The points for my course bombed from 385 in 2001 to 225 in 2002. The points began to steadily climb again, but in the proceeding years I know that some people applied for the course purely based on the low points requirement. They struggled with the course material and work load. Many failed and either repeated or dropped out.</p>

<p>Other similar courses such as Electronic Engineering experienced the same problems.</p>

<p>All this should be good news to me, right? Less competition and all that? Unfortunately, my pending departure from 3rd level education is coinciding with probably the most dramatic hic-up in the Irish and global economy.</p>

<p>Already, a number of companies well-known for hiring IT graduates have suspended hiring for the rest of the year due to &#8220;the current macro-economic environment&#8221;. I didn&#8217;t hear <em>that</em> mentioned in the RTE report.</p>

<p>I also think some companies are continuing to advertise for jobs not knowing if they will be able to actually take on new hires, probably because they don&#8217;t want to seem weak in the current climate.</p>

<p>I&#8217;m not expecting to fall out of my degree onto a smorgous board of opportunity waiting to snap me up. (Prove me wrong, world. Prove me wrong.) In fact, I think I&#8217;m going to have to really sell myself to land a good job where I&#8217;ll be competing against people that are out of work and who have a few year&#8217;s experience under their belts.</p>

<p>Are there plenty of jobs out there? I&#8217;m sure there is, but definitely not to the extent reported by RTE last Thursday.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[DrupalCamp Galway]]></title>
    <link href="http://andyregan.net/drupalcamp-galway/"/>
    <updated>2009-04-05T00:00:00+01:00</updated>
    <id>http://andyregan.net/drupalcamp-galway</id>
    <content type="html"><![CDATA[<p style="text-align: center;">
  <img class="aligncenter" src="http://groups.drupal.org/files/drupal_n_go.gif" alt="DrupalCamp Galway Logo" />
</p>


<p>Nathan and I attended <a href="http://groups.drupal.org/node/18452">DrupalCamp in Galway</a> on Saturday. John Long also made a suprise appearance! It was very well organised and over 60 people attended. Unfortunately, we could only attend on the Saturday. Many thanks and congratulations to the organisers.</p>

<p><a href="http://drupal.org/">Drupal</a> is an open source content management system with a very active contributing community. There&#8217;s a huge amount of contributed <a href="http://drupal.org/project/Modules">modules</a> available that allow users to extend the core functionality of the software. As a result, Drupal is extremely flexible and configurable.</p>

<p>Custom themes can also be easily applied. There are many free themes available at <a href="http://themegarden.org/drupal6/">themegarden.org</a>. Here&#8217;s a list of my favourites:</p>

<ul>
<li><a href="http://drupal.org/project/nitobe">nitobe</a></li>
<li><a href="http://drupal.org/project/painted">painted</a></li>
<li><a href="http://drupal.org/project/scruffy">scruffy</a></li>
<li><a href="http://drupal.org/project/nigraphic">nigraphic</a></li>
<li><a href="http://drupal.org/project/fresh_media">fresh_media</a></li>
<li><a href="http://drupal.org/project/foliage">foliage</a></li>
<li><a href="http://drupal.org/project/fervens">fervens</a></li>
<li><a href="http://drupal.org/project/deco">deco</a></li>
<li><a href="http://drupal.org/project/colorpaper">colorpaper</a></li>
<li><a href="http://drupal.org/project/burnt">burnt</a></li>
<li><a href="http://drupal.org/project/blossom">blossom</a></li>
<li><a href="http://drupal.org/project/blix">blix</a></li>
<li><a href="http://drupal.org/project/shallowgrunge">shallowgrunge</a></li>
<li><a href="http://drupal.org/project/ifeeldirty">ifeeldirty</a></li>
</ul>


<h3>Complexity vs Flexibility</h3>

<p>Unfortunately for new users, the amount of configuration options available is more than a bit overwhelming. I found that performing common tasks in a new install of Drupal is not as obvious as other content management systems, such as <a href="http://wordpress.org/">WordPress</a> or <a href="http://www.joomla.org/">Joomla</a>. Although well organised, the standard administrative interface feels overloaded with text.</p>

<p>There are a couple of ways to improve usability that were suggested by speakers at DrupalCamp. The <a href="http://drupal.org/project/admin_menu">Administration Menu</a> module provides a nice drop down navigation bar containing common admin tasks that becomes available when an administrator logs in. The <a href="http://drupal.org/project/rootcandy">RootCandy</a> theme is also an improvement on the default administration theme.</p>

<p>One gotcha when installing new modules is satisfying their dependent modules. You may have to track down and install dependent modules (and their dependent modules!) before you can active the original module you wanted.</p>

<p>While many â€œnewbiesâ€ (including myself) complain about the complexity of Drupal, it was mentioned by Alan Burke yesterday that the Drupal developers do not want to improve simplicity at the cost of flexibility. At the end of the day, some basic knowledge of web development is required.</p>

<p>I think some of the group that didn&#8217;t come from a technical background were expecting a kind of <em>Word for Websites</em>. While installing and activating modules may be confusing, it sure beats the hell out of coding the functionality from scratch! Anyone who&#8217;s been there will appreciate the advantages of Drupal.</p>

<p>In order to put what we learned into practice, myself and Nathan created <a href="http://andyregan.net/thatsnomoon">a simple website</a> using Drupal. After 10 minutes, we had a nicely themed and secure interactive website ready to be filled with content.</p>

<h3>Find Out More</h3>

<p>If you&#8217;re interested in Drupal, a good place to start is by signing up to <a href="http://drupal.org/">drupal.org</a> and joining a group such as <a href="http://groups.drupal.org/ireland">Ireland</a>. The Ireland group contains a thread on <a href="http://groups.drupal.org/node/20936">useful links that were mentioned at DrupalCamp</a>.</p>

<p>Drupal is also well <a href="http://drupal.org/handbooks">documented</a> thanks to contributors like <a href="http://www.lullabot.com/about/addison-berry">Addison Berry</a>.</p>

<p><strong>UPDATE:</strong> Fair play to all who created the <a href="http://www.zikomo.org/">Zikomo</a> and <a href="http://www.ruralsa.ie/">RSA</a> sites from scratch on Sunday! Wow.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Random Bits]]></title>
    <link href="http://andyregan.net/random-bits/"/>
    <updated>2009-03-08T00:00:00+00:00</updated>
    <id>http://andyregan.net/random-bits</id>
    <content type="html"><![CDATA[<p>I haven&#8217;t come across anything that deserves a full post this week, so here&#8217;s 5 interesting technologies I&#8217;ve come across recently:</p>

<ul>
<li><a href="http://www.cyberciti.biz/tips/understanding-linux-unix-umask-value-usage.html">umask</a>

<ul>
<li>How to set default permissions when creating files in linux</li>
</ul>
</li>
<li><a href="http://www.dohop.com/">DoHop.com</a>

<ul>
<li>Find Cheap Flights</li>
</ul>
</li>
<li><a href="http://crazybob.org/twubble/">Twubble</a>

<ul>
<li>Friends of Friends for Twitter</li>
</ul>
</li>
<li><a href="http://www.winterwell.com/software/jtwitter.php">JTwitter</a>

<ul>
<li>Java Library for the Twitter API</li>
</ul>
</li>
<li><a href="http://www.twitterlocal.net/">TwitterLocal</a>

<ul>
<li>Find tweets by location</li>
</ul>
</li>
</ul>


<p>And here&#8217;s some more randomness:</p>

<p><em>Switching to VoIP</em> by Ted Wallingford is very related to that 4IF1 are currently studying in Real Time Systems. Chapter 6 in particular.</p>

<p>When ordering books from Amazon, do not screw around during the ordering stage unless you want two of the same book. <em>/me hangs head in shame</em>.</p>

<p>The 3 wireless dongle works perfectly in Ubuntu.</p>

<p><a href="http://worldofgoo.com/dl2.php?lk=demo">World of Goo</a> is a very addictive game.</p>

<p>Finally, congrats to Emma Conway for her win in the NUIG Student Union elections. Unfortunately, Pofla didn&#8217;t get in.Â  I hoarded as many whispa&#8217;s as I possibly could to prevent their dispersal to the general populace to no avail.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Recovering Files From an Unmountable USB Key]]></title>
    <link href="http://andyregan.net/recovering-files-from-an-unmountable-usb-key/"/>
    <updated>2009-02-28T00:00:00+00:00</updated>
    <id>http://andyregan.net/recovering-files-from-an-unmountable-usb-key</id>
    <content type="html"><![CDATA[<p>The other night, myself and Rory managed to recover his friend&#8217;s thesis from a wonky USB thumb drive. We used <a href="http://www.cgsecurity.org/wiki/PhotoRec">PhotoRec</a> on Ubuntu Linux.
PhotoRec comes with the TestDisk utility. You can install TestDisk via:</p>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$apt</span>-get update
</span><span class='line'><span class="nv">$apt</span>-get install testdisk
</span></code></pre></td></tr></table></div></figure>


<p>The first thing we did was run <strong>dmesg</strong> in a terminal to get a bit of info on what was going on. We ran dmesg before and after we plugged
in the drive and noted the relevant output. The device eventually settled and was given the device location sdb by the kernel, but no
filesystem was found.
The partition was likely corrupted somehow.</p>

<p>TestDisk could be used to try to repair the partition on the disk, but it could also damage the data further. We decided to make an image to work with using <strong>dd</strong>:</p>

<p><strong>Use dd with care! Consult the man page for more info.</strong></p>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$sudo</span> dd <span class="k">if</span><span class="o">=</span>/dev/sdb <span class="nv">ou</span><span class="o">=</span>./disk_image
</span></code></pre></td></tr></table></div></figure>


<p>This copied the contents of the usb key block-by-block to a file called &#8220;disk_image&#8221;. The was a 2G image (the total capacity) of the wonky drive.</p>

<p>We then used <strong>photorec</strong> to try to recover any files from the image.</p>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$photorec</span> ./disk_image
</span></code></pre></td></tr></table></div></figure>


<p>Select the image to use.</p>

<p><img src="http://andyregan.net/images/posts/recovering-files-from-an-unmountable-usb-key/photorec1.png" title="Select the image to use" ></p>

<p>Select the partition type.</p>

<p><img src="http://andyregan.net/images/posts/recovering-files-from-an-unmountable-usb-key/photorec2.png" title="Select the partition type" ></p>

<p>Select the partition.</p>

<p><img src="http://andyregan.net/images/posts/recovering-files-from-an-unmountable-usb-key/photorec3.png" title="Select the partition" ></p>

<p>Select the filesystem type.</p>

<p><img src="http://andyregan.net/images/posts/recovering-files-from-an-unmountable-usb-key/photorec4.png" title="Select the filesystem type" ></p>

<p>Select where to save the recovered files.</p>

<p><img src="http://andyregan.net/images/posts/recovering-files-from-an-unmountable-usb-key/photorec5.png" title="Select where to save the recoverd files" ></p>

<p>Watch the search in progress.</p>

<p><img src="http://andyregan.net/images/posts/recovering-files-from-an-unmountable-usb-key/photorec6.png" title="Search in progress" ></p>

<p>Et voila! PhotoRec worked its magic and we recovered the thesis, along with all the other files.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Webcam Motion Detection in Ubuntu Linux]]></title>
    <link href="http://andyregan.net/webcam-motion-detection-in-ubuntu-linux/"/>
    <updated>2009-02-26T00:00:00+00:00</updated>
    <id>http://andyregan.net/webcam-motion-detection-in-ubuntu-linux</id>
    <content type="html"><![CDATA[<p>I bought a cheap usb webcam to add to the list of devices for my fyp. The idea is to push presence updates when motion is detected. I&#8217;ll be using <a href="http://www.lavrsen.dk/twiki/bin/view/Motion/WebHome">Motion</a> to handle motion detection.
Detailed <a href="http://infectedproject.com/2008/04/11/how-to-part-1-cheap-ubuntu-based-home-security/">installation and configuration instructions</a> can be found at InfectedProject.</p>

<p>You can set motion to run commands when certain events happen, such as an image is saved or a movie ends. For example, you could add the following to <strong>/etc/motion/motion.conf</strong> so that you get an email to you&#8217;re email account when a movie ends.</p>

<figure class='code'><figcaption><span>montion config </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="c"># Command to be executed when a movie file (.mpg|.avi) is closed. (default: none)</span>
</span><span class='line'><span class="c"># To give the filename as an argument to a command append it with %f</span>
</span><span class='line'>on_movie_end <span class="nb">echo</span> %f | mutt -s <span class="s2">&quot;[Motion]&quot;</span> -a %f joe@bloggs.com
</span></code></pre></td></tr></table></div></figure>



]]></content>
  </entry>
  
</feed>
