
<!DOCTYPE HTML>
<html>
<head>
	<meta charset="utf-8">
	<title>$whois andyregan</title>
	<meta name="author" content="Andrew Regan">

	
	<meta name="description" content="If you want to boot your domain from a CDROM (for example, if you wish to re-install the OS on the VM),
you can edit its configuration so that it &hellip;">
	
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

	<link href="/atom.xml" rel="alternate" title="$whois andyregan" type="application/atom+xml">
	<link rel="canonical" href="">
	<link href="/favicon.png" rel="shortcut icon">
	<link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
	<!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
	<script src="//ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
	
</head>

<body>
	<header id="header" class="inner"><h1><a href="/">$whois andyregan</a></h1>
<nav id="main-nav"><ul class="main">
	<li><a href="/about">About Me</a></li>
	<li><a href="/">Blog</a></li>
	<li><a href="/blog/archives">Archives</a></li>
</ul>
</nav>
<nav id="mobile-nav">
	<div class="alignleft menu">
		<a class="button">Menu</a>
		<div class="container"><ul class="main">
	<li><a href="/about">About Me</a></li>
	<li><a href="/">Blog</a></li>
	<li><a href="/blog/archives">Archives</a></li>
</ul>
</div>
	</div>
	<div class="alignright search">
		<a class="button"></a>
		<div class="container">
			<form action="http://google.com/search" method="get">
				<input type="text" name="q" results="0">
				<input type="hidden" name="q" value="site:andyregan.net">
			</form>
		</div>
	</div>
</nav>
<nav id="sub-nav" class="alignright">
	<div class="social">
		
		
		<a class="google" href="https://plus.google.com/113310779327489253368?rel=author" title="Google+">Google+</a>
		
		
		<a class="twitter" href="http://twitter.com/andyregan" title="Twitter">Twitter</a>
		
		
		<a class="github" href="https://github.com/andyregan" title="GitHub">GitHub</a>
		
    
		
		
		
		
		
		<a class="rss" href="/atom.xml" title="RSS">RSS</a>
		
	</div>
	<form class="search" action="http://google.com/search" method="get">
		<input class="alignright" type="text" name="q" results="0">
		<input type="hidden" name="q" value="site:andyregan.net">
	</form>
</nav>

</header>
	
		
<div id="banner" class="inner">
	<div class="container">
		<ul class="feed"></ul>
	</div>
	<small><a href="http://twitter.com/andyregan">andyregan</a> @ <a href="http://twitter.com">Twitter</a></small>
	<div class="loading">Loading...</div>
</div>
<script src="/javascripts/twitter.js"></script>
<script type="text/javascript">
	(function($){
		$('#banner').getTwitterFeed('andyregan', 1, false);
	})(jQuery);
</script>

	
	<div id="content" class="inner">


    <article class="post">
	<h2 class="title">
		
		<a href="/libvirt-kvm-booting-from-an-iso-image/">
		
			Libvirt + KVM : Booting From an ISO Image</a>
	</h2>
	<div class="entry-content">
		<p><img class="center" src="http://libvirt.org/libvirtLogo.png" width="200" title="libvirt logo" ></p>

<p>If you want to boot your domain from a CDROM (for example, if you wish to re-install the OS on the VM),
you can edit its configuration so that it boots from an ISO image on the host.</p>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>host:~# virsh edit name_of_domain
</span></code></pre></td></tr></table></div></figure>


<p>Within the <strong>os</strong> section, add a <strong>cdrom</strong> device. Make sure that it is placed before other boot devices, such as disks.</p>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>&lt;os&gt;
</span><span class='line'>    ...
</span><span class='line'>    &lt;boot <span class="nv">dev</span><span class="o">=</span><span class="s1">&#39;cdrom&#39;</span>/&gt;
</span><span class='line'>    &lt;boot <span class="nv">dev</span><span class="o">=</span><span class="s1">&#39;hd&#39;</span>/&gt;
</span><span class='line'>&lt;/os&gt;
</span></code></pre></td></tr></table></div></figure>


<p>Add an entry for a cdrom device (or edit an existing cdrom device) such that the <strong>type</strong> is <em>file</em> and the <strong>source</strong>
is the path to the ISO image on the host.</p>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>&lt;disk <span class="nb">type</span><span class="o">=</span><span class="s1">&#39;file&#39;</span> <span class="nv">device</span><span class="o">=</span><span class="s1">&#39;cdrom&#39;</span>&gt;
</span><span class='line'>      &lt;<span class="nb">source </span><span class="nv">file</span><span class="o">=</span><span class="s1">&#39;/path/to/install_media.iso&#39;</span>/&gt;
</span><span class='line'>       ...
</span><span class='line'>&lt;/disk&gt;
</span></code></pre></td></tr></table></div></figure>


<p>Save your changes and then reboot the domain. It should have booted into the ISO image. You can then attach a console
and continue the installation.</p>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>host:~# virt-viewer name_of_domain
</span></code></pre></td></tr></table></div></figure>


<h2>Edit</h2>

<p>I forgot (of course!) that you must undo the above changes after installation. Otherwise, it will continue to boot
into the ISO and not your shiny new OS.</p>

		
		
	</div>


<div class="meta">
	<div class="date">








  


<time datetime="2011-06-16T00:00:00+01:00" pubdate data-updated="true">2011-06-16</time></div>
	<div class="tags">


	<a class='category' href='/blog/categories/general-tips/'>General Tips</a>, <a class='category' href='/blog/categories/linux/'>Linux</a>


</div>
	
</div></article>


    <article class="post">
	<h2 class="title">
		
		<a href="/fixing-git-group-write-errors/">
		
			Fixing Git Group Write Errors</a>
	</h2>
	<div class="entry-content">
		<p><img class="center" src="/images/posts/fixing-git-group-write-errors/200px-Git-logo.svg_.png" width="200" title="&#34;200px Git logo&#34;" alt="&#34;200px Git logo&#34;"></p>

<h2>The Problem</h2>

<p>When many users are committing to the same git repository, the correct group permissions must be
set. For example, when a user recently tried to commit to a shared git repository, it failed
with the following error:</p>

<blockquote><p>fatal: failed to write object</p></blockquote>


<p>Looking at the repository&#8217;s config file on the server, the <strong>sharedRepository</strong> variable was not set.</p>

<h2>The Fix</h2>

<p>First, I fixed the group permissions for the repository (all the users belonged to the same group).</p>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>chmod -R g+swX /path/to/repository/
</span></code></pre></td></tr></table></div></figure>


<p>Then, I set the <strong>sharedRepository</strong> variable to <em>true</em>.</p>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span><span class="nb">cd</span> /path/to/repository/
</span><span class='line'><span class="nv">$ </span>git repo-config core.sharedRepository <span class="nb">true</span>
</span></code></pre></td></tr></table></div></figure>


<h2>More Info</h2>

<p>More information on this variable can be found in the git-config man page.</p>

<blockquote><p>core.sharedRepository  <br/>When group (or true), the repository is made shareable between several users in a group (making sure all the files and objects are group-writable). When all (or world or everybody), the  <br/>repository will be readable by all users, additionally to being group-shareable. When umask (or false), git will use permissions reported by umask(2). When 0xxx, where 0xxx is an octal  <br/>number, files in the repository will have this mode value. 0xxx will override user´s umask value, and thus, users with a safe umask (0077) can use this option. Examples: 0660 is equivalent  <br/>to group. 0640 is a repository that is group-readable but not group-writable. See git-init(1). False by default.</p></blockquote>


		
		
	</div>


<div class="meta">
	<div class="date">








  


<time datetime="2011-06-15T00:00:00+01:00" pubdate data-updated="true">2011-06-15</time></div>
	<div class="tags">


	<a class='category' href='/blog/categories/general-tips/'>General Tips</a>, <a class='category' href='/blog/categories/linux/'>Linux</a>


</div>
	
</div></article>


    <article class="post">
	<h2 class="title">
		
		<a href="/extract-a-tar-archive-to-multiple-directories-matching-a-pattern/">
		
			Extract a Tar Archive to Multiple Directories Matching a Pattern</a>
	</h2>
	<div class="entry-content">
		<p>Sometimes you may need to extract the same tar archive into many directories at once.</p>

<p>The below command extracts <strong>/path/to/archive.tgz</strong> into the directories from
<strong>/path/to/destination/00</strong> to <strong>/path/to/destination/29</strong> .</p>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="o">[</span>me@host ~<span class="o">]</span><span class="nv">$ </span>ls -d /path/to/destination/<span class="o">[</span>0-2<span class="o">][</span>0-9<span class="o">]</span>/ | xargs -I <span class="o">{}</span> tar -xvzf /path/to/archive.tgz -C <span class="o">{}</span>
</span></code></pre></td></tr></table></div></figure>




		
		
	</div>


<div class="meta">
	<div class="date">








  


<time datetime="2011-06-01T00:00:00+01:00" pubdate data-updated="true">2011-06-01</time></div>
	<div class="tags">


	<a class='category' href='/blog/categories/general-tips/'>General Tips</a>


</div>
	
</div></article>


    <article class="post">
	<h2 class="title">
		
		<a href="/requesting-gpus-at-job-submission-with-torque/">
		
			Requesting GPUs at Job Submission With Torque</a>
	</h2>
	<div class="entry-content">
		<p><img class="center" src="http://andyregan.net/blog/wp-content/uploads/2011/05/gpu_torque.jpg" title="A picture of a GPU card" alt="A picture of a GPU card"></p>

<p>According to the <a href="http://www.adaptivecomputing.com/resources/docs/torque/3.7schedulinggpus.php">Torque Documentation</a>, <strong>&#8220;in TORQUE 2.5.4 and later, users can request GPUs on a node at job submission&#8221;</strong>. This
post describes how to configure Torque for this functionality, allowing GPU resources to be scheduled among multiple users.</p>

<p>In a future post, I will also describe one approach that could be used to manage mutually exclusive CUDA access to NVIDIA GPUs on a
multi-GPU compute node.</p>

<p>The examples that follow involve a single workstation with 2 NVIDIA GPU devices.</p>

<h2>Informing Torque Where the GPUs Are</h2>

<p>In order for Torque to know which nodes have GPUs, you must update the <a href="http://www.adaptivecomputing.com/resources/docs/torque/1.5nodeconfig.php">nodes</a> file. In the following example, I have specified
that <strong>node1</strong> has 12 CPU cores and 2 GPU devices.</p>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>root@service-node:~# cat /var/spool/torque/server_priv/nodes
</span><span class='line'>node1 <span class="nv">np</span><span class="o">=</span>12 <span class="nv">gpus</span><span class="o">=</span>2
</span></code></pre></td></tr></table></div></figure>


<p>After saving the changes, you must restart <strong>pbs_server</strong> for the change to take affect.</p>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>root@service-node:~# /etc/init.d/pbs_server restart
</span></code></pre></td></tr></table></div></figure>


<p>Looking at the <strong>pbsnodes</strong> output, we can see that Torque is now aware that there should be 2 GPU devices on <strong>node1</strong>.</p>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>user@login-node:~# pbsnodes -a
</span><span class='line'>node1
</span><span class='line'>     <span class="nv">np</span> <span class="o">=</span> 12
</span><span class='line'>     <span class="nv">gpus</span> <span class="o">=</span> 2
</span></code></pre></td></tr></table></div></figure>


<h2>Requesting GPUs at job submission</h2>

<p>When submitting a job, a user can request GPU devices similar to how they request CPU cores. In the following example,
I&#8217;m requesting an <a href="http://www.clusterresources.com/torquedocs21/users/2.2files.shtml#interactive">interactive job</a> with 1 node , 1 processor per node and 2 GPUs per node.</p>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>user@login-node:~<span class="nv">$ </span>qsub -I -l <span class="nv">nodes</span><span class="o">=</span>1:ppn<span class="o">=</span>1:gpus<span class="o">=</span>2
</span><span class='line'>qsub: waiting <span class="k">for </span>job &lt;job id&gt; to start
</span><span class='line'>qsub: job &lt;job id&gt; ready
</span></code></pre></td></tr></table></div></figure>


<p>When the job starts, Torque populates a file whose path is specified by the environment variable <code>$PBS_GPUFILE</code>. Each
allocated GPU appears on a separate line within this file.</p>

<p>As you can see, the contents of <code>$PBS_GPUFILE</code> show that the job has been allocated GPU index 0 and 1 (the first and
second GPU) on node1 to execute on.</p>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>user@login-node:~<span class="nv">$ </span>env | grep PBS_GPUFILE
</span><span class='line'><span class="nv">PBS_GPUFILE</span><span class="o">=</span>/var/spool/torque/aux/JOB_IDgpu
</span></code></pre></td></tr></table></div></figure>




<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>user@login-node:~<span class="nv">$ </span>cat /var/spool/torque/aux/JOB_IDgpu
</span><span class='line'>node1-gpu0
</span><span class='line'>node1-gpu1
</span></code></pre></td></tr></table></div></figure>


<h2>Restricting the GPUs available to CUDA to Those Allocated</h2>

<p>As specified in Torque&#8217;s documentation, <strong>&#8220;it is left up to the job&#8217;s owner to make sure that the job executes properly on the GPU&#8221;</strong>.</p>

<p>In my next post, I will describe how you can take advantage of the $CUDA_VISIBLE_DEVICES environment variable (available since CUDA 3.1) to restrict the GPUs available to CUDA to those allocated by Torque.</p>

		
		
	</div>


<div class="meta">
	<div class="date">








  


<time datetime="2011-05-09T00:00:00+01:00" pubdate data-updated="true">2011-05-09</time></div>
	<div class="tags">


	<a class='category' href='/blog/categories/general-tips/'>General Tips</a>


</div>
	
</div></article>


    <article class="post">
	<h2 class="title">
		
		<a href="/allowing-debian-packages-to-execute-scripts-when-upgrading/">
		
			Allowing Debian Packages to Execute Scripts When Upgrading</a>
	</h2>
	<div class="entry-content">
		<p>As <a href="http://www.ichec.ie/about_us/david_delaharpegolden">David</a> came across this morning, some <a href="http://www.debian.org/">Debian</a> packages try to execute scripts in <strong>/tmp</strong>
during upgrade. Often <strong>/tmp</strong> is mounted <strong>noexec</strong> for security and this can cause upgrades to
fail. Files in partitions mounted <strong>noexec</strong> cannot be executed.</p>

<p>To complete the upgrades you can temporarily mount <strong>/tmp</strong> with <strong>exec</strong>, upgrade your packages
and then remount as per the <strong>noexec</strong> flag in your <strong>/etc/fstab</strong>.</p>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>mount -o remount,exec /tmp
</span><span class='line'><span class="nv">$ </span>aptitude safe-upgrade
</span><span class='line'><span class="nv">$ </span>mount -o remount /tmp
</span></code></pre></td></tr></table></div></figure>


<p>You can also <a href="http://wiki.mediatemple.net/w/%28ve%29:Configure_apt">change the default tmp directory that apt uses</a>.</p>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span><span class="nb">echo</span> <span class="s2">&quot;APT::ExtractTemplates::TempDir \&quot;/var/local/tmp\&quot;;&quot;</span> &gt;&gt; /etc/apt/apt.conf.d/50extracttemplates
</span><span class='line'><span class="nv">$ </span>mkdir /var/local/tmp/
</span></code></pre></td></tr></table></div></figure>




		
		
	</div>


<div class="meta">
	<div class="date">








  


<time datetime="2011-02-07T00:00:00+00:00" pubdate data-updated="true">2011-02-07</time></div>
	<div class="tags">


	<a class='category' href='/blog/categories/linux/'>Linux</a>


</div>
	
</div></article>


    <article class="post">
	<h2 class="title">
		
		<a href="/creating-dovecot-imap-folders-in-mail-app/">
		
			Creating Dovecot IMAP Folders in Mail.App</a>
	</h2>
	<div class="entry-content">
		<p>If you want to organise your Dovecot IMAP mailboxes into folders, it may seem intuitive to
just drag the them into a new mailbox. However, you may get the error message <strong>Target
mailbox doesn&#8217;t allow inferior mailboxes</strong>.</p>

<p>The solution is to explicitly create a folder, by adding a <code>/</code> to the end of the name you
give a new mailbox. Folders can contain other folders and mailboxes, whereas mailboxes
can only contain mail.</p>

<p>For example, in Mail.app go to <strong>Mailbox</strong> -> <strong>New Mailbox</strong> . Select where you want to
create the new folder and enter a name with a <code>/</code> at the end. If you don&#8217;t include the
<code>/</code>, a new mailbox will be created.</p>

<p><a href="/images/posts/creating-dovecot-imap-folders-in-mail-app/Screen-shot-2011-02-06-at-17.07.53.png"><img class="center" src="/images/posts/creating-dovecot-imap-folders-in-mail-app/Screen-shot-2011-02-06-at-17.07.53.png" title="'Screenshot of Mail.app'" ></a></p>

<p>In the image below, you can see a folder called <strong>TEST</strong> that contains a sub-folder
called <strong>TEST2</strong> and a mailbox called <strong>test</strong>.</p>

<p><a href="/images/posts/creating-dovecot-imap-folders-in-mail-app/Screen-shot-2011-02-06-at-17.08.24.png"><img class="center" src="/images/posts/creating-dovecot-imap-folders-in-mail-app/Screen-shot-2011-02-06-at-17.08.24.png" title="'Screen shot of Mail.app'" ></a></p>

<p>While the above example uses Mail.app, you&#8217;ll also need to add a <code>/</code> to the end of
Dovecot IMAP folder names in other clients such as Mozilla Thunderbird.</p>

		
		
	</div>


<div class="meta">
	<div class="date">








  


<time datetime="2011-02-06T00:00:00+00:00" pubdate data-updated="true">2011-02-06</time></div>
	<div class="tags">


	<a class='category' href='/blog/categories/general-tips/'>General Tips</a>


</div>
	
</div></article>


    <article class="post">
	<h2 class="title">
		
		<a href="/mac-mini-resolution-problems-edids-and-hdmi-matrix-switchers/">
		
			Mac Mini Resolution Problems &#8211; EDIDs and HDMI Matrix Switchers</a>
	</h2>
	<div class="entry-content">
		<p><a href="http://ichec.ie">ICHEC</a>&#8217;s offices are located on opposite sides of the country. Thanks to video conferencing,
our Dublin and Galway-based staff are able to hold frequent virtual meetings to cut down on
travel. When staff (or visitors) need to share content, such as a presentation, they can connect
their laptop to the video conferencing unit (a <a href="http://www.polycom.com/products/telepresence_video/telepresence_solutions/room_telepresence/hdx7000.html">Polycom HDX 7000</a>). They can then select the
content to display to the local and remote members of the conference call.</p>

<p>To cater for different types of video output, we use a HDMI Matrix Switcher that can take input
from a VGA, a DVI, or a HMDI cable and output to either the TV directly, the video conference
unit or both.</p>

<p><a href="/images/posts/mac-mini-resolution-problems-edids-and-hdmi-matrix-switchers/matrix_switcher.jpg"><img class="center" src="/images/posts/mac-mini-resolution-problems-edids-and-hdmi-matrix-switchers/matrix_switcher.jpg" width="300" title="matrix switcher" alt="matrix switcher"></a></p>

<p>We recently purchased a <a href="http://www.apple.com/macmini/">Mac Mini</a> for use as a permanent conference room PC connected
through the Matrix Switcher. Unfortunately, we found that the highest resolution on TV was only
full 1080p when the Polycom was left powered off. If the Polycom was powered on, the maximum
resolution to the TV was much lower. Worse, the Polycom intermittently failed to receive a
signal from the Mac Mini.</p>

<p><a href="http://upload.wikimedia.org/wikipedia/commons/thumb/6/67/2010_Mac_Mini_Ports.jpg/800px-2010_Mac_Mini_Ports.jpg"><img class="center" src="http://upload.wikimedia.org/wikipedia/commons/thumb/6/67/2010_Mac_Mini_Ports.jpg/800px-2010_Mac_Mini_Ports.jpg" width="300" title="Mac Mini" alt="Mac Mini"></a></p>

<p>Googling around for information, it seemed that the Mac Mini was confusing the EDID information
from the TV and Polycom unit as the data was coming through the Matrix Switcher. An <a href="http://en.wikipedia.org/wiki/Extended_display_identification_data">EDID
(Extended display identification data)</a> is how a digital display, like a monitor or TV,
tells your computer about itself. Your computer, through it&#8217;s graphics card, determines supported
display settings based on the EDID data is has received from your monitor. We tried a few
different suggested solutions without success.</p>

<p>In a stroke of sheer luck and brilliance, <a href="http://www.ichec.ie/about_us/david_delaharpegolden.php">David</a> found a <a href="http://www.kanexlive.com/products/iAdapt51.html">Kanex USB powered mini-DVI to HDMI
adapter</a> in a box of spare cables. One of the features of the adapter is <strong>&#8220;an auto EDID feature
built-in that adapts to maximum resolution depending on users display&#8221;</strong>. He plugged it in between
the Mac Mini and the Matrix Switcher and, lo and behold, we had consistent 1080p resolution to
both the TV and the Polycom!</p>

<p><a href="http://www.kanexlive.com/products/iAdapt51.html"><img class="center" src="/images/posts/mac-mini-resolution-problems-edids-and-hdmi-matrix-switchers/adapter-300x133.jpg" width="300" title="Kanex Adapter" alt="Kanex Adapter"></a></p>

<p>Another thing to watch out for is signal distortion when using a long-ish HDMI cable from the Mac
Mini to the TV. The shorter the cable, the better.</p>

<p>You might notice that the image does not quite fit the TV at first. Try setting the TV to <strong>PC</strong>
or <strong>Dot by Dot</strong> mode. Finally, you may also need to adjust the TV&#8217;s sharpness settings. We
found that if the sharpness was set too high, the OS X fonts would look pixelated.</p>

<p>Hopefully, someone might find this info useful.</p>

		
		
	</div>


<div class="meta">
	<div class="date">








  


<time datetime="2011-02-05T00:00:00+00:00" pubdate data-updated="true">2011-02-05</time></div>
	<div class="tags">


	<a class='category' href='/blog/categories/apple/'>Apple</a>


</div>
	
</div></article>


    <article class="post">
	<h2 class="title">
		
		<a href="/how-to-use-ssh-tunneling-to-access-a-subversion-server-behind-nat/">
		
			How to Use SSH Tunneling to Access a Subversion Server Behind NAT</a>
	</h2>
	<div class="entry-content">
		<h2>Now why would I want to do that?</h2>

<p>Let&#8217;s say that you have a subversion repository hosted on a PC in your office. It cannot be
accessed directly from the outside world because it is behind NAT.</p>

<p>If you can&#8217;t connect to a VPN or forward ports, but you <strong>can</strong> SSH from the server hosting
your repository to the client that will access the repository, then your could try using a
reverse SSH tunnel.</p>

<h2>Example</h2>

<p>In the following example, I&#8217;m assuming that both the server hosting the subversion repository
and the client trying to access the repository are running either a Linux distro or OS X. I&#8217;m
also assuming that you are accessing the repository using svn+ssh and that openssh (or
similar) is installed on both the client and server. (That&#8217;s a lot of assumptions!)</p>

<p>For the sake of simplicity, I&#8217;ll call the subversion server <strong>host-a</strong> and the client <strong>host-b</strong>.</p>

<h3>On Host-A</h3>

<p>Since you can SSH from host-a to host-b, the first thing you&#8217;ll need to do is create a reverse
SHH tunnel. Run the following command in a terminal on host-a where <strong>username</strong> is a valid
username on host-b.</p>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>ssh -fN -R 3022:localhost:22 username@host-b
</span></code></pre></td></tr></table></div></figure>


<p>This will prompt you to enter your account password on host-b and will open a new reverse
tunnel in the background. You can confirm that the tunnel is active using the ps command.</p>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="o">[</span>host-a<span class="o">]</span><span class="nv">$ </span>ps aux | grep 3022:
</span></code></pre></td></tr></table></div></figure>


<h3>On Host-B</h3>

<p>Next, (from any host) log into your account on host-b . Using the following command, you
should see that host-b is listening for incoming connections on port 3022.</p>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="o">[</span>host-b<span class="o">]</span><span class="nv">$netstat</span> -aln | grep 3022
</span></code></pre></td></tr></table></div></figure>


<p>Now edit the file at <code>~/.subversion/config</code> so that the following line is under the <code>[tunnels]</code>
section:</p>

<figure class='code'><figcaption><span>~/.subversion/config </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="o">[</span>tunnels<span class="o">]</span>
</span><span class='line'><span class="nv">sshtunnel</span> <span class="o">=</span> ssh -p 3022
</span></code></pre></td></tr></table></div></figure>


<p>You can then check out your repository from host-a with the following command where <strong>username</strong> is
your username on host-a.
<strong>(Note that the tunnel you opened from the subversion server must be still open)</strong></p>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>svn co svn+sshtunnel://username@localhost/path/to/svn/repository /path/to/local/copy
</span></code></pre></td></tr></table></div></figure>


<p>Once you&#8217;ve initially checked out the repository, you can add files, commit and update as you
normally would (as long as the ssh tunnel is still open from host-a).</p>

<h3>Horrible Attempt At A Helpful Diagram</h3>

<p>Sorry folks!</p>

<p><img class="center" src="/images/posts/how-to-use-ssh-tunneling-to-access-a-subversion-server-behind-nat/tunnel_example.png" title="ssh tunnel example" alt="ssh tunnel example"></p>

<h3>What do I need to do if I&#8217;m using git and not subversion?</h3>

<p>Glad you asked. You&#8217;ll need to add the following to <code>~/.ssh/config</code> on host-b.</p>

<figure class='code'><figcaption><span>~/.ssh/config </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>Host host-a
</span><span class='line'>HostName localhost
</span><span class='line'>Port 3022
</span></code></pre></td></tr></table></div></figure>


<p>Then you can just use use <code>[host-b]$ssh username@host-a</code> instead of <code>[host-b]$ssh -p 3022 localhost</code> .</p>

<p>So to clone the repository om host-a:</p>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="o">[</span>host-b<span class="o">]</span>git clone git+ssh://host-a/path/to/repo /path/to/local/clone
</span></code></pre></td></tr></table></div></figure>


<h3>Resources</h3>

<p>The following links contain more reverse tunnel tricks.</p>

<ul>
<li>http://www.marksanborn.net/howto/bypass-firewall-and-nat-with-reverse-ssh-tunnel/</li>
<li>http://rhnotebook.wordpress.com/2010/02/13/reverse-ssh-port-forwarding-t-o-i-c-o-r-g/</li>
</ul>


		
		
	</div>


<div class="meta">
	<div class="date">








  


<time datetime="2011-02-04T00:00:00+00:00" pubdate data-updated="true">2011-02-04</time></div>
	<div class="tags">


	<a class='category' href='/blog/categories/linux/'>Linux</a>


</div>
	
</div></article>


    <article class="post">
	<h2 class="title">
		
		<a href="/renaming-many-files-at-once-with-pattern-matching-in-bash/">
		
			Renaming Many Files at Once With Pattern Matching in Bash</a>
	</h2>
	<div class="entry-content">
		<p>Sometimes you may need to rename many files at once in a similar way, such as removing a
specific string from their name. Rather than manually rename the files, you can use a method
described at <a href="http://snipplr.com/view/3648/batch-file-rename-with-awk-and-sed/">snipplr.com</a>. One of the advantages of this method is that you can preview
the changes you will make simply by omitting the final pipe to <code>/bin/bash</code> .</p>

<p>Let&#8217;s say you have a bunch of files which contain patterns you would like to remove. In the
following example, you might need to remove the string <strong>PatternOne.</strong> and <strong>PatternTwo.</strong>
from each file&#8217;s name.</p>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>ls -1 /path/to/files/
</span><span class='line'>PatternOne.001.PatternTwo.avi
</span><span class='line'>PatternOne.002.PatternTwo.avi
</span><span class='line'>PatternOne.003.PatternTwo.avi
</span><span class='line'>PatternOne.004.PatternTwo.avi
</span></code></pre></td></tr></table></div></figure>


<p>The first step is to use <code>awk</code> to create a serious of <code>mv</code> statements.</p>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>ls *.avi | awk <span class="s1">&#39;{print(&quot;mv &quot;$1&quot; &quot;$1)}&#39;</span>
</span><span class='line'>mv PatternOne.001.PatternTwo.avi PatternOne.001.PatternTwo.avi
</span><span class='line'>mv PatternOne.002.PatternTwo.avi PatternOne.002.PatternTwo.avi
</span><span class='line'>mv PatternOne.003.PatternTwo.avi PatternOne.003.PatternTwo.avi
</span><span class='line'>mv PatternOne.004.PatternTwo.avi PatternOne.004.PatternTwo.avi
</span></code></pre></td></tr></table></div></figure>


<p>Next, we pipe the <code>mv</code> statements to a <code>sed</code> command which removes <strong>PatternOne.</strong> from
the <code>mv</code> statement&#8217;s destination file.</p>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>ls *.avi | awk <span class="s1">&#39;{print(&quot;mv &quot;$1&quot; &quot;$1)}&#39;</span> | sed <span class="s1">&#39;s/PatternOne.//2&#39;</span>
</span><span class='line'>mv PatternOne.001.PatternTwo.avi 001.PatternTwo.avi
</span><span class='line'>mv PatternOne.002.PatternTwo.avi 002.PatternTwo.avi
</span><span class='line'>mv PatternOne.003.PatternTwo.avi 003.PatternTwo.avi
</span><span class='line'>mv PatternOne.004.PatternTwo.avi 004.PatternTwo.avi
</span></code></pre></td></tr></table></div></figure>


<p>Add another <code>sed</code> statement to remove <strong>PatternTwo.</strong></p>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>ls *.avi | awk <span class="s1">&#39;{print(&quot;mv &quot;$1&quot; &quot;$1)}&#39;</span> | sed <span class="s1">&#39;s/PatternOne.//2&#39;</span>| sed <span class="s1">&#39;s/PatternTwo.//2&#39;</span>
</span><span class='line'>mv PatternOne.001.PatternTwo.avi 001.avi
</span><span class='line'>mv PatternOne.002.PatternTwo.avi 002.avi
</span><span class='line'>mv PatternOne.003.PatternTwo.avi 003.avi
</span><span class='line'>mv PatternOne.004.PatternTwo.avi 004.avi
</span></code></pre></td></tr></table></div></figure>


<p>Finally, pipe the result to <code>/bin/sh</code> so that the <code>mv</code> statements are run.</p>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>ls *.avi | awk <span class="s1">&#39;{print(&quot;mv &quot;$1&quot; &quot;$1)}&#39;</span> | sed <span class="s1">&#39;s/PatternOne.//2&#39;</span>| sed <span class="s1">&#39;s/PatternTwo.//2&#39;</span> | /bin/sh
</span></code></pre></td></tr></table></div></figure>




		
		
	</div>


<div class="meta">
	<div class="date">








  


<time datetime="2010-11-25T00:00:00+00:00" pubdate data-updated="true">2010-11-25</time></div>
	<div class="tags">


	<a class='category' href='/blog/categories/general-tips/'>General Tips</a>


</div>
	
</div></article>


    <article class="post">
	<h2 class="title">
		
		<a href="/firewalling-bridged-vms-using-libvirts-nwfilter-driver/">
		
			Firewalling Bridged VMs Using Libvirt&#8217;s Nwfilter Driver</a>
	</h2>
	<div class="entry-content">
		<p><a href="http://libvirt.org/"><img class="center" src="http://libvirt.org/libvirtLogo.png" width="200" title="libvirt logo" ></a></p>

<p>Recently, I needed to create a virtual machine to host an internet-facing web application. One of the
requirements for this VM included setting up a firewall on the VM&#8217;s host as well as on the guest itself
to provide an added layer of security.</p>

<p>Versions of <a href="http://libvirt.org/">libvirt</a> since 8.0 include the nwfilter driver. This driver allows you to define simple
network filtering rules in XML. Libvirt can then translate your rules to iptables/ebtables. More
information and examples are available at the <a href="http://libvirt.org/firewall.html">Libvirt Firewall Documentation</a> page.</p>

<p>It&#8217;s worth noting that while I found my nwfilter rules worked on Debian Squeeze (unstable), they did
not work on Debian Lenny. Even though I had upgraded libvirt to a more recent version from backports,
it&#8217;s likely that newer versions of dependent packages, such as iptables, are required also.</p>

<p>Another potential gotcha is described in the libvirt documentation:</p>

<blockquote><p>Finally, in terms of problems we have in deployment. The biggest problem is that if the admin does <br/>service iptables restart all our work gets blown away. We’ve experimented with using lokkit to <br/>record our custom rules in a persistent config file, but that caused different problem. Admins who <br/>were not using lokkit for their config found that all their own rules got blown away. So we threw <br/>away our lokkit code. Instead we document that if you run service iptables restart, you need to <br/>send SIGHUP to libvirt to make it recreate its rules.</p></blockquote>


<p>Unfortunately, there appears to be a <a href="http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=602428">bug</a> in the current version of libvirt-bin on Squeeze
(0.8.3-3) that causes the libvirt daemon to crash when you try to reload. This has been fixed
upstream. While waiting for next Debian Squeeze release of libvirt-bin, you can use the following
trick should iptables be restarted.</p>

<p>Simply, run <code>$virsh nwfilter-edit your-custom-template.xml</code> . Add a newline to the end of your XML
and save. Virsh will re-create your defined rules.</p>

		
		
	</div>


<div class="meta">
	<div class="date">








  


<time datetime="2010-11-19T00:00:00+00:00" pubdate data-updated="true">2010-11-19</time></div>
	<div class="tags">


	<a class='category' href='/blog/categories/linux/'>Linux</a>


</div>
	
</div></article>

<nav id="pagenavi">
    
    
        <a href="/blog/page/2/" class="next">Next</a>
    
    <div class="center"><a href="/blog/archives">Blog Archives</a></div>
</nav></div>
	<footer id="footer" class="inner">Copyright &copy; 2013

    Andrew Regan

</footer>
	<script src="/javascripts/slash.js"></script>
<!-- <script src="/javascripts/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
(function($){
	$('.fancybox').fancybox();
})(jQuery);
</script> --> <!-- Delete or comment this line to disable Fancybox -->







</body>
</html>