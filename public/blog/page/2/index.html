
<!DOCTYPE HTML>
<html>
<head>
	<meta charset="utf-8">
	<title>$whois andyregan</title>
	<meta name="author" content="Andrew Regan">

	
	<meta name="description" content="Now why would I want to do that? Let&#8217;s say that you have a subversion repository hosted on a PC in your office. It cannot be
accessed directly &hellip;">
	
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

	<link href="/atom.xml" rel="alternate" title="$whois andyregan" type="application/atom+xml">
	<link rel="canonical" href="">
	<link href="/favicon.png" rel="shortcut icon">
	<link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
	<!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
	<script src="//ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
	
</head>

<body>
	<header id="header" class="inner"><h1><a href="/">$whois andyregan</a></h1>
<nav id="main-nav"><ul class="main">
	<li><a href="/about">About Me</a></li>
	<li><a href="/">Blog</a></li>
	<li><a href="/blog/archives">Archives</a></li>
</ul>
</nav>
<nav id="mobile-nav">
	<div class="alignleft menu">
		<a class="button">Menu</a>
		<div class="container"><ul class="main">
	<li><a href="/about">About Me</a></li>
	<li><a href="/">Blog</a></li>
	<li><a href="/blog/archives">Archives</a></li>
</ul>
</div>
	</div>
	<div class="alignright search">
		<a class="button"></a>
		<div class="container">
			<form action="http://google.com/search" method="get">
				<input type="text" name="q" results="0">
				<input type="hidden" name="q" value="site:andyregan.net">
			</form>
		</div>
	</div>
</nav>
<nav id="sub-nav" class="alignright">
	<div class="social">
		
		
		
		<a class="twitter" href="http://twitter.com/andyregan" title="Twitter">Twitter</a>
		
		
		<a class="github" href="https://github.com/andyregan" title="GitHub">GitHub</a>
		
    
		
		
		
		
		
		<a class="rss" href="/atom.xml" title="RSS">RSS</a>
		
	</div>
	<form class="search" action="http://google.com/search" method="get">
		<input class="alignright" type="text" name="q" results="0">
		<input type="hidden" name="q" value="site:andyregan.net">
	</form>
</nav>

</header>
	
		
<div id="banner" class="inner">
	<div class="container">
		<ul class="feed"></ul>
	</div>
	<small><a href="http://twitter.com/andyregan">andyregan</a> @ <a href="http://twitter.com">Twitter</a></small>
	<div class="loading">Loading...</div>
</div>
<script src="/javascripts/twitter.js"></script>
<script type="text/javascript">
	(function($){
		$('#banner').getTwitterFeed('andyregan', 4, false);
	})(jQuery);
</script>

	
	<div id="content" class="inner">


    <article class="post">
	<h2 class="title">
		
		<a href="/how-to-use-ssh-tunneling-to-access-a-subversion-server-behind-nat/">
		
			How to Use SSH Tunneling to Access a Subversion Server Behind NAT</a>
	</h2>
	<div class="entry-content">
		<h2>Now why would I want to do that?</h2>

<p>Let&#8217;s say that you have a subversion repository hosted on a PC in your office. It cannot be
accessed directly from the outside world because it is behind NAT.</p>

<p>If you can&#8217;t connect to a VPN or forward ports, but you <strong>can</strong> SSH from the server hosting
your repository to the client that will access the repository, then your could try using a
reverse SSH tunnel.</p>

<h2>Example</h2>

<p>In the following example, I&#8217;m assuming that both the server hosting the subversion repository
and the client trying to access the repository are running either a Linux distro or OS X. I&#8217;m
also assuming that you are accessing the repository using svn+ssh and that openssh (or
similar) is installed on both the client and server. (That&#8217;s a lot of assumptions!)</p>

<p>For the sake of simplicity, I&#8217;ll call the subversion server <strong>host-a</strong> and the client <strong>host-b</strong>.</p>

<h3>On Host-A</h3>

<p>Since you can SSH from host-a to host-b, the first thing you&#8217;ll need to do is create a reverse
SHH tunnel. Run the following command in a terminal on host-a where <strong>username</strong> is a valid
username on host-b.</p>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>ssh -fN -R 3022:localhost:22 username@host-b
</span></code></pre></td></tr></table></div></figure>


<p>This will prompt you to enter your account password on host-b and will open a new reverse
tunnel in the background. You can confirm that the tunnel is active using the ps command.</p>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="o">[</span>host-a<span class="o">]</span><span class="nv">$ </span>ps aux | grep 3022:
</span></code></pre></td></tr></table></div></figure>


<h3>On Host-B</h3>

<p>Next, (from any host) log into your account on host-b . Using the following command, you
should see that host-b is listening for incoming connections on port 3022.</p>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="o">[</span>host-b<span class="o">]</span><span class="nv">$netstat</span> -aln | grep 3022
</span></code></pre></td></tr></table></div></figure>


<p>Now edit the file at <code>~/.subversion/config</code> so that the following line is under the <code>[tunnels]</code>
section:</p>

<figure class='code'><figcaption><span>~/.subversion/config </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="o">[</span>tunnels<span class="o">]</span>
</span><span class='line'><span class="nv">sshtunnel</span> <span class="o">=</span> ssh -p 3022
</span></code></pre></td></tr></table></div></figure>


<p>You can then check out your repository from host-a with the following command where <strong>username</strong> is
your username on host-a.
<strong>(Note that the tunnel you opened from the subversion server must be still open)</strong></p>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>svn co svn+sshtunnel://username@localhost/path/to/svn/repository /path/to/local/copy
</span></code></pre></td></tr></table></div></figure>


<p>Once you&#8217;ve initially checked out the repository, you can add files, commit and update as you
normally would (as long as the ssh tunnel is still open from host-a).</p>

<h3>Horrible Attempt At A Helpful Diagram</h3>

<p>Sorry folks!</p>

<p><img class="center" src="/images/posts/how-to-use-ssh-tunneling-to-access-a-subversion-server-behind-nat/tunnel_example.png" title="ssh tunnel example" alt="ssh tunnel example"></p>

<h3>What do I need to do if I&#8217;m using git and not subversion?</h3>

<p>Glad you asked. You&#8217;ll need to add the following to <code>~/.ssh/config</code> on host-b.</p>

<figure class='code'><figcaption><span>~/.ssh/config </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>Host host-a
</span><span class='line'>HostName localhost
</span><span class='line'>Port 3022
</span></code></pre></td></tr></table></div></figure>


<p>Then you can just use use <code>[host-b]$ssh username@host-a</code> instead of <code>[host-b]$ssh -p 3022 localhost</code> .</p>

<p>So to clone the repository om host-a:</p>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="o">[</span>host-b<span class="o">]</span>git clone git+ssh://host-a/path/to/repo /path/to/local/clone
</span></code></pre></td></tr></table></div></figure>


<h3>Resources</h3>

<p>The following links contain more reverse tunnel tricks.</p>

<ul>
<li>http://www.marksanborn.net/howto/bypass-firewall-and-nat-with-reverse-ssh-tunnel/</li>
<li>http://rhnotebook.wordpress.com/2010/02/13/reverse-ssh-port-forwarding-t-o-i-c-o-r-g/</li>
</ul>


		
		
	</div>


<div class="meta">
	<div class="date">








  


<time datetime="2011-02-04T00:00:00+00:00" pubdate data-updated="true">2011-02-04</time></div>
	<div class="tags">


	<a class='category' href='/blog/categories/linux/'>Linux</a>


</div>
	
</div></article>


    <article class="post">
	<h2 class="title">
		
		<a href="/renaming-many-files-at-once-with-pattern-matching-in-bash/">
		
			Renaming Many Files at Once With Pattern Matching in Bash</a>
	</h2>
	<div class="entry-content">
		<p>Sometimes you may need to rename many files at once in a similar way, such as removing a
specific string from their name. Rather than manually rename the files, you can use a method
described at <a href="http://snipplr.com/view/3648/batch-file-rename-with-awk-and-sed/">snipplr.com</a>. One of the advantages of this method is that you can preview
the changes you will make simply by omitting the final pipe to <code>/bin/bash</code> .</p>

<p>Let&#8217;s say you have a bunch of files which contain patterns you would like to remove. In the
following example, you might need to remove the string <strong>PatternOne.</strong> and <strong>PatternTwo.</strong>
from each file&#8217;s name.</p>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>ls -1 /path/to/files/
</span><span class='line'>PatternOne.001.PatternTwo.avi
</span><span class='line'>PatternOne.002.PatternTwo.avi
</span><span class='line'>PatternOne.003.PatternTwo.avi
</span><span class='line'>PatternOne.004.PatternTwo.avi
</span></code></pre></td></tr></table></div></figure>


<p>The first step is to use <code>awk</code> to create a serious of <code>mv</code> statements.</p>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>ls *.avi | awk <span class="s1">&#39;{print(&quot;mv &quot;$1&quot; &quot;$1)}&#39;</span>
</span><span class='line'>mv PatternOne.001.PatternTwo.avi PatternOne.001.PatternTwo.avi
</span><span class='line'>mv PatternOne.002.PatternTwo.avi PatternOne.002.PatternTwo.avi
</span><span class='line'>mv PatternOne.003.PatternTwo.avi PatternOne.003.PatternTwo.avi
</span><span class='line'>mv PatternOne.004.PatternTwo.avi PatternOne.004.PatternTwo.avi
</span></code></pre></td></tr></table></div></figure>


<p>Next, we pipe the <code>mv</code> statements to a <code>sed</code> command which removes <strong>PatternOne.</strong> from
the <code>mv</code> statement&#8217;s destination file.</p>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>ls *.avi | awk <span class="s1">&#39;{print(&quot;mv &quot;$1&quot; &quot;$1)}&#39;</span> | sed <span class="s1">&#39;s/PatternOne.//2&#39;</span>
</span><span class='line'>mv PatternOne.001.PatternTwo.avi 001.PatternTwo.avi
</span><span class='line'>mv PatternOne.002.PatternTwo.avi 002.PatternTwo.avi
</span><span class='line'>mv PatternOne.003.PatternTwo.avi 003.PatternTwo.avi
</span><span class='line'>mv PatternOne.004.PatternTwo.avi 004.PatternTwo.avi
</span></code></pre></td></tr></table></div></figure>


<p>Add another <code>sed</code> statement to remove <strong>PatternTwo.</strong></p>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>ls *.avi | awk <span class="s1">&#39;{print(&quot;mv &quot;$1&quot; &quot;$1)}&#39;</span> | sed <span class="s1">&#39;s/PatternOne.//2&#39;</span>| sed <span class="s1">&#39;s/PatternTwo.//2&#39;</span>
</span><span class='line'>mv PatternOne.001.PatternTwo.avi 001.avi
</span><span class='line'>mv PatternOne.002.PatternTwo.avi 002.avi
</span><span class='line'>mv PatternOne.003.PatternTwo.avi 003.avi
</span><span class='line'>mv PatternOne.004.PatternTwo.avi 004.avi
</span></code></pre></td></tr></table></div></figure>


<p>Finally, pipe the result to <code>/bin/sh</code> so that the <code>mv</code> statements are run.</p>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>ls *.avi | awk <span class="s1">&#39;{print(&quot;mv &quot;$1&quot; &quot;$1)}&#39;</span> | sed <span class="s1">&#39;s/PatternOne.//2&#39;</span>| sed <span class="s1">&#39;s/PatternTwo.//2&#39;</span> | /bin/sh
</span></code></pre></td></tr></table></div></figure>




		
		
	</div>


<div class="meta">
	<div class="date">








  


<time datetime="2010-11-25T00:00:00+00:00" pubdate data-updated="true">2010-11-25</time></div>
	<div class="tags">


	<a class='category' href='/blog/categories/general-tips/'>General Tips</a>


</div>
	
</div></article>


    <article class="post">
	<h2 class="title">
		
		<a href="/firewalling-bridged-vms-using-libvirts-nwfilter-driver/">
		
			Firewalling Bridged VMs Using Libvirt&#8217;s Nwfilter Driver</a>
	</h2>
	<div class="entry-content">
		<p><a href="http://libvirt.org/"><img class="center" src="http://libvirt.org/libvirtLogo.png" width="200" title="libvirt logo" ></a></p>

<p>Recently, I needed to create a virtual machine to host an internet-facing web application. One of the
requirements for this VM included setting up a firewall on the VM&#8217;s host as well as on the guest itself
to provide an added layer of security.</p>

<p>Versions of <a href="http://libvirt.org/">libvirt</a> since 8.0 include the nwfilter driver. This driver allows you to define simple
network filtering rules in XML. Libvirt can then translate your rules to iptables/ebtables. More
information and examples are available at the <a href="http://libvirt.org/firewall.html">Libvirt Firewall Documentation</a> page.</p>

<p>It&#8217;s worth noting that while I found my nwfilter rules worked on Debian Squeeze (unstable), they did
not work on Debian Lenny. Even though I had upgraded libvirt to a more recent version from backports,
it&#8217;s likely that newer versions of dependent packages, such as iptables, are required also.</p>

<p>Another potential gotcha is described in the libvirt documentation:</p>

<blockquote><p>Finally, in terms of problems we have in deployment. The biggest problem is that if the admin does <br/>service iptables restart all our work gets blown away. We’ve experimented with using lokkit to <br/>record our custom rules in a persistent config file, but that caused different problem. Admins who <br/>were not using lokkit for their config found that all their own rules got blown away. So we threw <br/>away our lokkit code. Instead we document that if you run service iptables restart, you need to <br/>send SIGHUP to libvirt to make it recreate its rules.</p></blockquote>


<p>Unfortunately, there appears to be a <a href="http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=602428">bug</a> in the current version of libvirt-bin on Squeeze
(0.8.3-3) that causes the libvirt daemon to crash when you try to reload. This has been fixed
upstream. While waiting for next Debian Squeeze release of libvirt-bin, you can use the following
trick should iptables be restarted.</p>

<p>Simply, run <code>$virsh nwfilter-edit your-custom-template.xml</code> . Add a newline to the end of your XML
and save. Virsh will re-create your defined rules.</p>

		
		
	</div>


<div class="meta">
	<div class="date">








  


<time datetime="2010-11-19T00:00:00+00:00" pubdate data-updated="true">2010-11-19</time></div>
	<div class="tags">


	<a class='category' href='/blog/categories/linux/'>Linux</a>


</div>
	
</div></article>


    <article class="post">
	<h2 class="title">
		
		<a href="/lack-of-entropy-on-virtual-machine/">
		
			Lack of Entropy on Virtual Machine</a>
	</h2>
	<div class="entry-content">
		<p>If you are generating <a href="http://www.gnupg.org/">GPG keys</a> on a virtual machine, you may encounter the following error.</p>

<p><code>Not enough random bytes available. Please do some other work to give the OS a chance to collect more entropy!</code></p>

<p>Operating systems generate randomness based on hardware input. This randomness is collected for
use in applications which require random data (such as cryptographic applications). However, a virtual OS
does not have the same level of access to real hardware. As a result, the usual source of randomness
expected by the operating system is not available. The measure of randomness currently available (entropy)
can be viewed by running</p>

<figure class='code'><figcaption><span>entropy in linux </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>cat /proc/sys/kernel/random/entropy_avail
</span></code></pre></td></tr></table></div></figure>


<p>If the entropy pool drains, <strong>/dev/random</strong> will block until additional entropy is collected. One solution
is to use <strong>/dev/urandom</strong> as a source. This will not block, but will produce lower quality randomness.
You can use <strong>/dev/urandom</strong> by installing <a href="http://packages.debian.org/lenny/rng-tools">rng-tools</a> and adding the following to <strong>/etc/default/rng-tools</strong>.
Save and then restart rng-tools.</p>

<figure class='code'><figcaption><span>/etc/default/rng-tools </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">HRNGDEVICE</span><span class="o">=</span>/dev/urandom
</span></code></pre></td></tr></table></div></figure>


<p>Unfortunately, using <strong>/dev/urandom</strong> is not suitable for my security requirements. A better solution
would be to use a hardware entropy generator as described in <a href="http://strugglers.net/~andy/blog/2010/06/06/adventures-in-entropy-part-1/">Andy Smith&#8217;s excellent post</a> .</p>

<p>As a short-term work-around, I decided to generate keys on a physical host with a good quality source of
randomness and then <a href="http://www.debuntu.org/how-to-import-export-gpg-key-pair">import</a> them on the remote host.</p>

		
		
	</div>


<div class="meta">
	<div class="date">








  


<time datetime="2010-07-27T00:00:00+01:00" pubdate data-updated="true">2010-07-27</time></div>
	<div class="tags">


	<a class='category' href='/blog/categories/linux/'>Linux</a>


</div>
	
</div></article>


    <article class="post">
	<h2 class="title">
		
		<a href="/fix-mac-os-x-dns-failure-on-upc-router/">
		
			Fix Mac OS X DNS Failure on UPC Router</a>
	</h2>
	<div class="entry-content">
		<p>About a week ago, I upgraded my MacBook Pro to OS X 10.6.4. Since then, I&#8217;ve had trouble with the internet
connection <strong>only</strong> from my house and <strong>only</strong> on my MBP. Sometimes the connection would work fine, but
most of the time Firefox/Safari would only load the first couple of pages and then new pages would start to
time out.</p>

<p>Since I could ping/view a site by going to the server&#8217;s IP address directly, the issue appeared to be with
the MBP resolving <a href="http://en.wikipedia.org/wiki/Domain_Name_System">DNS</a>. DNS is how your computer translates a human readable URL such as
<strong>andyregan.net</strong> to a machine readable IP address.</p>

<p>Since the problem was <strong>only</strong> with my UPC connection (router is Cisco EPC2425), I thought changing DNS
provider to <a href="http://code.google.com/speed/public-dns/">Google</a> or <a href="http://www.opendns.com/">OpenDNS</a> might do the trick. Alas, the new DNS servers would work for the
first few pages and then pages started timing out again.</p>

<p>After poking around the (extremely limited) options on the UPC router, I noticed that there were a ton of
firewall blocks for the 192.168.1.0/24 network over the last week. Devices connecting to the router, such
as my MBP, are assigned IP addresses within this range.</p>

<p>On closer inspection, I discovered that the router&#8217;s firewall was blocking the MBP from the DNS servers
for <strong>LAN-side UDP Flood</strong>. I turned off the router&#8217;s firewall and restarted it. Et voila! Bob&#8217;s your
uncle.</p>

<p>My guess is that the firewall blocks must be due to some change in DNS behavior since the last OS X
update. Posting here to save some poor soul the heartache. It&#8217;s important to note that turning off your
router&#8217;s firewall is at your own risk.</p>

		
		
	</div>


<div class="meta">
	<div class="date">








  


<time datetime="2010-07-17T00:00:00+01:00" pubdate data-updated="true">2010-07-17</time></div>
	<div class="tags">


	<a class='category' href='/blog/categories/random/'>Random</a>


</div>
	
</div></article>


    <article class="post">
	<h2 class="title">
		
		<a href="/quickly-reset-linux-file-and-directory-permissions/">
		
			Quickly Reset Linux File and Directory Permissions</a>
	</h2>
	<div class="entry-content">
		<h2>Reset File Permissions</h2>

<p>Just a quick post so I can keep these commands handy (since I keep forgetting them). These will allow you to quickly set
different <a href="http://www.linuxquestions.org/linux/answers/Security/Quick_and_Dirty_Guide_to_Linux_File_Permissions">permissions</a> for all files (or all folders) within a specific directory in Linux.</p>

<figure class='code'><figcaption><span>reset files </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>find /path/to/directory/ -type f -exec chmod 644 <span class="o">{}</span> <span class="se">\;</span>
</span></code></pre></td></tr></table></div></figure>


<h2>Reset Directory Permissions</h2>

<figure class='code'><figcaption><span>reset directories </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>find /path/to/directory/ -type d -exec chmod 755 <span class="o">{}</span> <span class="se">\;</span>
</span></code></pre></td></tr></table></div></figure>


<h2>Reset Permissions on 777 PHP Files Only</h2>

<figure class='code'><figcaption><span>reset 777 php files </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>find /path/to/directory/ -name <span class="se">\*</span>.php -perm 777 -type f -exec chmod 644 <span class="o">{}</span> <span class="se">\;</span>
</span></code></pre></td></tr></table></div></figure>




		
		
	</div>


<div class="meta">
	<div class="date">








  


<time datetime="2010-02-25T00:00:00+00:00" pubdate data-updated="true">2010-02-25</time></div>
	<div class="tags">


	<a class='category' href='/blog/categories/general-tips/'>General Tips</a>


</div>
	
</div></article>


    <article class="post">
	<h2 class="title">
		
		<a href="/setting-up-a-new-cakephp-environment-in-ubuntu/">
		
			Setting Up a New CakePHP Environment in Ubuntu</a>
	</h2>
	<div class="entry-content">
		<p><a href="http://cakephp.org"><img class="center" src="/images/posts/setting-up-a-new-cakephp-environment-in-ubuntu/cakephp_logo_250_trans-150x150.png" width="150" title="CakePHP Logo" alt="CakePHP Logo"></a></p>

<p><a href="http://cakephp.org">CakePHP</a> is a useful <a href="http://hubpages.com/hub/MVC">MVC</a> framework for PHP applications. However, there are a few common gotchas when setting up a new development
environment. In this post, I will go through how to get around these issues when setting up a new environment on a <a href="http://en.wikipedia.org/wiki/LAMP_%28software_bundle%29">LAMP</a> (Linux Apache
MySQL PHP) server, in this case server running an <a href="http://www.ubuntu.com">Ubuntu</a> OS. Please leave a comment if you have any feedback or
can recommend any improvements on the suggestions here.</p>

<h2>Grab a Copy and Get Started</h2>

<p>The first thing you&#8217;ll need to do is <a href="http://compsoc.nuigalway.ie/wiki/how_to:apache">get a local LAMP server up and running</a>. Then, grab
a fresh copy of CakePHP from <a href="http://cakephp.org">cakephp.org</a>. This site also has some useful resources if you&#8217;d like to learn more about the framework.</p>

<figure class='code'><figcaption><span>Grab the source </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>wget http://download.github.com/cakephp-cakephp1x-ef18ab2.tar.gz
</span></code></pre></td></tr></table></div></figure>


<p>Once you have downloaded the tarball, extract it and then rename the new directory to something more useful. This is the root directory of
the application.</p>

<figure class='code'><figcaption><span>Extract the source </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>tar -xvvzf cakephp-cakephp1x-ef18ab2.tar.gz
</span><span class='line'><span class="nv">$ </span>mv cakephp-cakephp1x-ef18ab2/ cake_project/
</span></code></pre></td></tr></table></div></figure>


<h2>Make Tmp/ Writable</h2>

<p>Next, you need to make sure that the <strong>tmp/</strong> directory is writeable. To avoid using insecure 777 permissions, I recommend installing <a href="http://www.suphp.org/Home.html">suPHP</a>.
SuPHP allows PHP scripts to be run as their owner rather than as the default Apache user (<strong>www-data</strong>). As a result, you can use more secure
file and directory permissions while still allowing the <strong>tmp/</strong> directory to be writeable by the application. Generally, 755 permissions
are sufficiently secure for directories and 644 for files.</p>

<p>Install the correct packages, enable <strong>suphp</strong> and disable the <strong>php5</strong> module.</p>

<figure class='code'><figcaption><span>Prepare the Environment </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>sudo apt-get install libapache2-mod-suphp suphp-common
</span><span class='line'><span class="nv">$ </span>sudo a2enmod suphp;sudo a2dismod php5;sudo /etc/init.d/apache2 restart
</span></code></pre></td></tr></table></div></figure>


<h2>Add A Dash of Salt</h2>

<p>With that out of the way, now you need to change the default salt value for the application. CakePHP needs a random string (&#8220;salt&#8221;) which is
used to generate secure hashes. I find the <a href="http://linux.die.net/man/1/pwgen">pwgen</a> utility in Linux very useful for quickly generating a random string.</p>

<p>Open up <strong>app/config/core.php</strong>. Then, replace the <strong>random_string</strong> value below with the output of the <strong>pwgen</strong> command .</p>

<figure class='code'><figcaption><span>app/config/core.php </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="x">Configure::write(&#39;Security.salt&#39;, &#39;random_string&#39;);</span>
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><figcaption><span>Prepare the Environment </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>pwgen -y 100
</span></code></pre></td></tr></table></div></figure>


<h2>Point Your Domain at the Cake Directory</h2>

<p>You can use Apache&#8217;s <a href="http://httpd.apache.org/docs/2.1/mod/mod_userdir.html">userdir</a> module to test your application. This will allow you to go to <strong>http://yourdomain.com/~username&#8221;</strong> in your
browser where <strong>/home/username/public_html</strong> is the document root. However, this often conflicts with the Apache <a href="http://httpd.apache.org/docs/1.3/mod/mod_rewrite.html">rewrite</a> module which
is necessary for &#8220;friendly&#8221; URLs.</p>

<p>To get around this conflict on a local development environment, I recommend pointing your domain at the application&#8217;s root directory. In
this way, when you go to the domain in your browser it will show you the newly installed CakePHP application.</p>

<p>First, add a rule to your computer&#8217;s <strong>/etc/hosts</strong> file so that the domain points to <a href="http://en.wikipedia.org/wiki/Localhost">localhost</a>.</p>

<figure class='code'><figcaption><span>/etc/hosts </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>127.0.0.1       caketest.com www.caketest.com
</span></code></pre></td></tr></table></div></figure>


<p>Then, add and enable a <a href="http://httpd.apache.org/docs/1.3/vhosts/">vhost</a> for the domain you are working on.</p>

<figure class='code'><figcaption><span>Edit the vhost </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>sudo vim /etc/apache2/sites-available/caketest.com
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><figcaption><span>/etc/apache2/sites-available/caketest.com </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>&lt;VirtualHost *:80 &gt;
</span><span class='line'><span class="c">#Basic setup  </span>
</span><span class='line'>ServerAdmin webmaster@mydomain.com
</span><span class='line'>ServerName caketest.com
</span><span class='line'>ServerAlias www.caketest.com
</span><span class='line'>DocumentRoot /home/andrew/public_html/cake
</span><span class='line'>
</span><span class='line'>ErrorLog /home/andrew/public_html/cake/error_log/error.log
</span><span class='line'>
</span><span class='line'>&lt;Directory /home/andrew/public_html/cake&gt;
</span><span class='line'>Order Deny,Allow
</span><span class='line'>Allow from all
</span><span class='line'><span class="c"># Don&#39;t show indexes for directories  </span>
</span><span class='line'>Options -Indexes
</span><span class='line'>&lt;/Directory&gt;
</span><span class='line'>&lt;/VirtualHost&gt;
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><figcaption><span>restart apache </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>sudo a2ensite caketest.com;/etc/init.d/apache2 restart
</span></code></pre></td></tr></table></div></figure>


<h2>Why is Everything Black and White?</h2>

<p>If the new Cake installation displays without any CSS markup, make sure that the Apache rewrite module is enabled. After that, your done.</p>

<figure class='code'><figcaption><span>Enable the rewrite module </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>sudo a2enmod rewrite;/etc/init.d/apache2 restart
</span></code></pre></td></tr></table></div></figure>


<p>At this point, you might want to check out the <a href="http://book.cakephp.org/">CakePHP documentation</a> which will give you more information on what to do from here.
You should also check out this article on <a href="http://www.tiplite.com/cakephp-support-in-netbeans/">using Netbeans as your developemnt IDE for CakePHP projects</a>.</p>

		
		
	</div>


<div class="meta">
	<div class="date">








  


<time datetime="2010-02-16T00:00:00+00:00" pubdate data-updated="true">2010-02-16</time></div>
	<div class="tags">


	<a class='category' href='/blog/categories/web-development/'>Web Development</a>


</div>
	
</div></article>


    <article class="post">
	<h2 class="title">
		
		<a href="/nasty-site-hack-leads-to-phony-google-links/">
		
			Nasty Site Hack Leads to Phony Google Links</a>
	</h2>
	<div class="entry-content">
		<h2>Thar be nasty scripts here!</h2>

<p><img class="center" src="http://andyregan.net/blog/wp-content/uploads/2009/07/tornado_warning.gif" width="300" title="Warning Sign" alt="Thar be nasty scripts here!"></p>

<p>Came across a dirty (but interesting) website hack today. Essentially when a person googled their domain name they discovered hundreds
and hundreds of phony links pointing to a sub-directory of their site. (With various explicitly charming descriptions).
Clicking on these links displayed a page full of advertisements.</p>

<p>Had a nose around the sub-directory in question and couldn&#8217;t find any files corresponding to the links.</p>

<p>Eventually, I found a rogue PHP script (called <strong>report.php</strong>). Turns out that the <a href="http://httpd.apache.org/docs/1.3/howto/htaccess.html">.htaccess</a> file in the directory had been modified
to redirect any <strong><a href="http://en.wikipedia.org/wiki/HTTP_404">404 Not Found</a></strong> errors to the PHP script. Even dirtier still was that when you accessed the script directly in a
browser it showed a typical default 404 error, a tactic I guess is there to add confusion when you are trying to find the cause of the
hack. <strong>Bastards</strong>.</p>

<p>Script was <a href="http://www.wewatchyourwebsite.com/wordpress/?p=136">base64</a>&#8216;d and full of typical randomness meant to slow down those trying to figure out exactly what it&#8217;s trying to do.
As far as I can tell, it just serves up ad pages when it&#8217;s redirected to and the 404 error page when accessed directly.</p>

<p>The ultimate bastardly thing about this hack is that even after you clean up your site, it&#8217;ll be ages before the explicit phony links
dissappear from Google. Another good reason to avoid 777 permissions of directories and keep your web software updated.</p>

<p>Just wanted to make people aware of it. If you come across something similar have a look in the <strong>.htaccess</strong> file first. :)</p>

<h2>UPDATE</h2>

<p>The following bash one-liner can help find any files that contain a call to the base64_encode() method. Some legitimate files may be
included, but this should help narrow down the list of dirty scripts.</p>

<figure class='code'><figcaption><span>snippet </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$find</span> . -type f | xargs grep -l base64_encode
</span></code></pre></td></tr></table></div></figure>


<p>Also worth checking out the following links for htaccess tips and tricks:</p>

<ul>
<li><a href="http://www.askapache.com/htaccess/apache-htaccess.html">http://www.askapache.com/htaccess/apache-htaccess.html</a></li>
<li><a href="http://perishablepress.com/press/2006/01/10/stupid-htaccess-tricks/#sec1">http://perishablepress.com/press/2006/01/10/stupid-htaccess-tricks/#sec1</a></li>
</ul>


		
		
	</div>


<div class="meta">
	<div class="date">








  


<time datetime="2009-07-29T00:00:00+01:00" pubdate data-updated="true">2009-07-29</time></div>
	<div class="tags">


	<a class='category' href='/blog/categories/web-development/'>Web Development</a>


</div>
	
</div></article>


    <article class="post">
	<h2 class="title">
		
		<a href="/shoot-first-questions-later/">
		
			Shoot First Questions Later</a>
	</h2>
	<div class="entry-content">
		<p><a href="http://www.digitalmediaforum.net/event_profile.php?id=292"><img class="center" src="/images/posts/shoot-first-questions-later/sfql_graphic.png"" title="SFQL Graphic" alt="SFQL Graphic"> </a></p>

<p><a href="http://www.digitalmediaforum.net/event_profile.php?id=292">SFQL</a> is a different approach to business networking. Break the ice by playing a few LAN games and having a laugh. Afterwards, head to a nearby pub for some refreshments and have a chance to chat with like-minded people in the tech industry from Galway.</p>

<p>It&#8217;s happening May 6th from 7pm in Squareyes, Forster St (near Eyre Square). The cost of gaming is &euro;6.</p>

<p>This is a <a href="http://www.digitalmediaforum.net/about.php">Digital Media Forum</a> event. The idea was born at the last Digital Media Breakfast in Galway and has been put together thanks to <a href="http://twitter.com/antonmannering/">@antonmannering</a> and <a href="http://www.squareyes.com/">Squareyes</a>.</p>

<p>Promises to be good craic! Join via <a href="http://www.digitalmediaforum.net/event_profile.php?id=292">the event page</a> so we&#8217;ll have some idea of numbers. Thanks! :)</p>

		
		
	</div>


<div class="meta">
	<div class="date">








  


<time datetime="2009-04-29T00:00:00+01:00" pubdate data-updated="true">2009-04-29</time></div>
	<div class="tags">


	<a class='category' href='/blog/categories/random/'>Random</a>


</div>
	
</div></article>


    <article class="post">
	<h2 class="title">
		
		<a href="/new-theme/">
		
			New Theme</a>
	</h2>
	<div class="entry-content">
		<p>I got a bit sick of the old fusion theme. The new theme is based on the <a href="http://themes.jestro.com/vigilance/">Vigilance Theme</a> by <a href="http://www.jestro.com/">Jestro</a> with some tweaks suggested in an excellent <a href="http://healyourchurchwebsite.com/2008/12/01/working-with-the-wordpress-theme-vigilance-116/">article by Dean Peters</a> along with a couple of tweaks of my own.</p>

<p>Header image is a photo I took atop the <a href="http://maps.google.com/maps?f=q&amp;source=s_q&amp;hl=en&amp;geocode=&amp;q=silver+strand+galway&amp;sll=53.273797,-9.05178&amp;sspn=0.091155,0.30899&amp;ie=UTF8&amp;ll=53.251299,-9.124403&amp;spn=0.0114,0.038624&amp;t=h&amp;z=15&amp;iwloc=I">cliff at Silver Strand overlooking Galway Bay</a>.</p>

<p>It&#8217;s a lot cleaner and I think it&#8217;s easier to read, too. Hope you like it!</p>

		
		
	</div>


<div class="meta">
	<div class="date">








  


<time datetime="2009-04-29T00:00:00+01:00" pubdate data-updated="true">2009-04-29</time></div>
	<div class="tags">


	<a class='category' href='/blog/categories/web-development/'>Web Development</a>


</div>
	
</div></article>

<nav id="pagenavi">
    
        <a href="/" class="prev">Prev</a>
    
    
        <a href="/blog/page/3/" class="next">Next</a>
    
    <div class="center"><a href="/blog/archives">Blog Archives</a></div>
</nav></div>
	<footer id="footer" class="inner">Copyright &copy; 2013

    Andrew Regan

</footer>
	<script src="/javascripts/slash.js"></script>
<!-- <script src="/javascripts/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
(function($){
	$('.fancybox').fancybox();
})(jQuery);
</script> --> <!-- Delete or comment this line to disable Fancybox -->







</body>
</html>